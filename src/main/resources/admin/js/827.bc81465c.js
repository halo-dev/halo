"use strict";(self["webpackChunkhalo_admin"]=self["webpackChunkhalo_admin"]||[]).push([[827],{55659:function(t,e,a){a.d(e,{Z:function(){return y}});var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-drawer",{attrs:{afterVisibleChange:t.handleAfterVisibleChanged,visible:t.visible,width:t.isMobile()?"100%":"480",closable:"",destroyOnClose:"",title:"评论列表"},on:{close:t.onClose}},[a("a-row",{attrs:{align:"middle",type:"flex"}},[a("a-col",{attrs:{span:24}},[a("a-list",{attrs:{itemLayout:"horizontal"}},[a("a-list-item",[a("a-list-item-meta",[a("template",{slot:"description"},[a("p",{staticClass:"comment-drawer-content",domProps:{innerHTML:t._s(t.description)}})]),a("h3",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.title))])],2)],1)],1)],1),a("a-divider"),a("a-col",{attrs:{span:24}},[a("a-spin",{attrs:{spinning:t.list.loading}},[0===t.list.data.length?a("a-empty"):t._l(t.list.data,(function(e,s){return a("TargetCommentTree",{key:s,attrs:{comment:e},on:{delete:t.handleCommentDelete,editStatus:t.handleEditStatusClick,reply:t.handleCommentReply}})}))],2)],1)],1),a("a-divider"),a("div",{staticClass:"page-wrapper"},[a("a-pagination",{attrs:{current:t.list.pagination.page,defaultPageSize:t.list.pagination.size,total:t.list.pagination.total,showLessItems:""},on:{change:t.handlePaginationChange}})],1),a("a-divider",{staticClass:"divider-transparent"}),a("div",{staticClass:"bottom-control"},[a("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.handleCommentReply({})}}},[t._v("评论")])],1),a("a-modal",{attrs:{title:t.replyModalTitle,destroyOnClose:""},on:{close:t.onReplyModalClose},model:{value:t.replyModal.visible,callback:function(e){t.$set(t.replyModal,"visible",e)},expression:"replyModal.visible"}},[a("template",{slot:"footer"},[a("ReactiveButton",{attrs:{errored:t.replyModal.saveErrored,loading:t.replyModal.saving,erroredText:"回复失败",loadedText:"回复成功",text:"回复",type:"primary"},on:{callback:t.handleReplyCallback,click:t.handleReplyClick}})],1),a("a-form-model",{ref:"replyCommentForm",attrs:{model:t.replyModal.model,rules:t.replyModal.rules,layout:"vertical"}},[a("a-form-model-item",{attrs:{prop:"content"}},[a("a-input",{ref:"contentInput",attrs:{autoSize:{minRows:8},type:"textarea"},model:{value:t.replyModal.model.content,callback:function(e){t.$set(t.replyModal.model,"content",e)},expression:"replyModal.model.content"}})],1)],1)],2)],1)},i=[],l=a(3832),n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("a-comment",[a("template",{slot:"actions"},["AUDITING"===t.comment.status?a("a-dropdown",{attrs:{trigger:["click"]}},[a("span",[t._v("通过")]),a("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[a("a-menu-item",{key:"1",on:{click:function(e){return t.handleEditStatusClick("PUBLISHED")}}},[t._v(" 通过")]),a("a-menu-item",{key:"2"},[t._v(" 通过并回复")])],1)],1):"PUBLISHED"===t.comment.status?a("span",{on:{click:t.handleReplyClick}},[t._v("回复")]):"RECYCLE"===t.comment.status?a("a-popconfirm",{attrs:{title:"你确定要还原该评论？",cancelText:"取消",okText:"确定"},on:{confirm:function(e){return t.handleEditStatusClick("PUBLISHED")}}},[t._v(" 还原 ")]):t._e(),"PUBLISHED"===t.comment.status||"AUDITING"===t.comment.status?a("a-popconfirm",{attrs:{title:"你确定要将该评论移到回收站？",cancelText:"取消",okText:"确定"},on:{confirm:function(e){return t.handleEditStatusClick("RECYCLE")}}},[t._v(" 回收站 ")]):t._e(),a("a-popconfirm",{attrs:{title:"你确定要永久删除该评论？",cancelText:"取消",okText:"确定"},on:{confirm:t.handleDeleteClick}},[t._v(" 删除 ")])],1),a("a",{attrs:{slot:"author",href:t.comment.authorUrl,target:"_blank"},slot:"author"},[t.comment.isAdmin?a("a-icon",{staticStyle:{"margin-right":"3px"},attrs:{type:"user"}}):t._e(),t._v(" "+t._s(t.comment.author)+" ")],1),a("a-avatar",{attrs:{slot:"avatar",alt:t.comment.author,src:t.comment.avatar,size:"large"},slot:"avatar"}),a("p",{attrs:{slot:"content"},domProps:{innerHTML:t._s(t.content)},slot:"content"}),a("a-tooltip",{attrs:{slot:"datetime"},slot:"datetime"},[a("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(t._f("moment")(t.comment.createTime)))]),a("span",[t._v(t._s(t._f("timeAgo")(t.comment.createTime)))])]),t.comment.children?t._l(t.comment.children,(function(e,s){return a("TargetCommentTree",t._g(t._b({key:s,attrs:{comment:e},on:{delete:t.handleDeleteClick,editStatus:t.handleEditStatusClick,reply:t.handleReplyClick}},"TargetCommentTree",t.$attrs,!1),t.$listeners))})):t._e()],2)],1)},o=[],r=a(90952),d={name:"TargetCommentTree",props:{comment:{type:Object,required:!1,default:null}},computed:{content(){return r.TU.parse(this.comment.content)}},methods:{handleReplyClick(){this.$emit("reply",this.comment)},handleEditStatusClick(t){this.$emit("editStatus",this.comment,t)},handleDeleteClick(){this.$emit("delete",this.comment)}}},c=d,m=a(18156),h=(0,m.Z)(c,n,o,!1,null,null,null),u=h.exports,p=a(1540),f={name:"TargetCommentDrawer",mixins:[l.jB,l.KT],components:{TargetCommentTree:u},data(){return{list:{data:[],loading:!1,selected:{},pagination:{page:1,size:10,sort:null,total:1},queryParam:{page:0,size:10,sort:null,keyword:null}},replyModal:{model:{},visible:!1,saving:!1,saveErrored:!1,rules:{content:[{required:!0,message:"* 内容不能为空",trigger:["change"]}]}}}},props:{visible:{type:Boolean,required:!1,default:!1},title:{type:String,required:!1,default:""},description:{type:String,required:!1,default:""},target:{type:String,required:!1,default:""},id:{type:Number,required:!1,default:0}},computed:{replyModalTitle(){return this.list.selected.id?`回复给：${this.list.selected.author}`:"评论"}},methods:{handleListComments(){this.list.loading=!0,this.list.queryParam.page=this.list.pagination.page-1,this.list.queryParam.size=this.list.pagination.size,this.list.queryParam.sort=this.list.pagination.sort,p.Z.comment.listAsTreeView(this.target,this.id,this.list.queryParam).then((t=>{this.list.data=t.data.content,this.list.pagination.total=t.data.total})).finally((()=>{this.list.loading=!1}))},handlePaginationChange(t,e){this.list.pagination.page=t,this.list.pagination.size=e,this.handleListComments()},handleCommentReply(t){this.list.selected=t,this.replyModal.visible=!0,this.replyModal.model.parentId=t.id,this.replyModal.model.postId=this.id,this.$nextTick((()=>{this.$refs.contentInput.focus()}))},handleReplyClick(){const t=this;t.$refs.replyCommentForm.validate((e=>{e&&(t.replyModal.saving=!0,p.Z.comment.create(t.target,t.replyModal.model).catch((()=>{t.replyModal.saveErrored=!0})).finally((()=>{setTimeout((()=>{t.replyModal.saving=!1}),400)})))}))},handleReplyCallback(){this.replyModal.saveErrored?this.replyModal.saveErrored=!1:(this.replyModal.model={},this.list.selected={},this.replyModal.visible=!1,this.handleListComments())},handleEditStatusClick(t,e){p.Z.comment.updateStatusById(this.target,t.id,e).then((()=>{this.$message.success("操作成功！")})).finally((()=>{this.handleListComments()}))},handleCommentDelete(t){p.Z.comment["delete"](this.target,t.id).then((()=>{this.$message.success("删除成功！")})).finally((()=>{this.handleListComments()}))},onReplyModalClose(){this.replyModal.model={},this.list.selected={},this.replyModal.visible=!1},onClose(){this.list.data=[],this.list.pagination={page:1,size:10,sort:""},this.$emit("close",!1)},handleAfterVisibleChanged(t){t&&this.handleListComments()}}},g=f,v=(0,m.Z)(g,s,i,!1,null,null,null),y=v.exports},10827:function(t,e,a){a.r(e),a.d(e,{default:function(){return P}});var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-view",[a("a-row",[a("a-col",{attrs:{span:24}},[a("div",{staticClass:"card-container"},[a("a-tabs",{attrs:{type:"card"},model:{value:t.activeKey,callback:function(e){t.activeKey=e},expression:"activeKey"}},t._l(t.panes,(function(e){return a("a-tab-pane",{key:e.key},[a("span",{attrs:{slot:"tab"},slot:"tab"},[a("a-icon",{attrs:{type:e.icon}}),t._v(t._s(e.title)+" ")],1),a(e.component,{tag:"component"})],1)})),1)],1)])],1)],1)},i=[],l=a(50990),n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t.isMobile()?a("a-list",{attrs:{dataSource:t.independentSheets,loading:t.loading,pagination:!1,itemLayout:"vertical",size:"large"},scopedSlots:t._u([{key:"renderItem",fn:function(e,s){return a("a-list-item",{key:s},[a("template",{slot:"actions"},[a("span",[a("router-link",{attrs:{to:{name:e.routeName}}},[a("a-icon",{attrs:{type:"edit"}})],1)],1)]),a("template",{slot:"extra"},[e.available?a("span",[t._v("可用")]):a("span",[t._v("不可用 "),a("a-tooltip",{attrs:{slot:"action",title:"当前主题没有对应模板"},slot:"action"},[a("a-icon",{attrs:{type:"info-circle-o"}})],1)],1)]),a("a-list-item-meta",[a("span",{staticStyle:{"max-width":"300px",display:"block","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"},attrs:{slot:"title"},slot:"title"},[e.available?a("a",{attrs:{href:e.fullPath,target:"_blank"}},[t._v(t._s(e.title))]):a("a",{attrs:{href:e.fullPath,disabled:"",target:"_blank"}},[t._v(t._s(e.title))])])])],2)}}],null,!1,490164655)}):a("a-table",{attrs:{columns:t.independentColumns,dataSource:t.independentSheets,loading:t.loading,pagination:!1,rowKey:function(t){return t.id}},scopedSlots:t._u([{key:"available",fn:function(e){return[e?a("span",[t._v("可用")]):a("span",[t._v(" 不可用 "),a("a-tooltip",{attrs:{slot:"action",title:"当前主题没有对应模板"},slot:"action"},[a("a-icon",{attrs:{type:"info-circle-o"}})],1)],1)]}},{key:"action",fn:function(e,s){return a("span",{},[a("router-link",{attrs:{to:{name:s.routeName}}},[a("a-button",{staticClass:"!p-0",attrs:{type:"link"}},[t._v("管理")])],1),a("a-divider",{attrs:{type:"vertical"}}),s.available?a("a",{attrs:{href:s.fullPath,target:"_blank"}},[t._v("访问")]):a("a",{attrs:{href:s.fullPath,disabled:"",target:"_blank"}},[t._v("访问")])],1)}}])})],1)},o=[],r=a(3832),d=a(1540);const c=[{title:"页面名称",dataIndex:"title"},{title:"访问地址",dataIndex:"fullPath"},{title:"状态",dataIndex:"available",scopedSlots:{customRender:"available"}},{title:"操作",dataIndex:"action",width:"150px",scopedSlots:{customRender:"action"}}];var m={name:"IndependentSheetList",mixins:[r.jB,r.KT],data(){return{independentColumns:c,independentSheets:[],loading:!1}},created(){this.handleListIndependentSheets()},methods:{async handleListIndependentSheets(){try{const{data:t}=await d.Z.sheet.listIndependents();this.independentSheets=t}catch(t){this.$log.error(t)}finally{this.loading=!1}}}},h=m,u=a(18156),p=(0,u.Z)(h,n,o,!1,null,null,null),f=p.exports,g=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t.isMobile()?a("a-list",{attrs:{dataSource:t.list.data,loading:t.list.loading,pagination:!1,itemLayout:"vertical",size:"large"},scopedSlots:t._u([{key:"renderItem",fn:function(e,s){return[a("a-list-item",{key:s,scopedSlots:t._u([{key:"actions",fn:function(){return[a("span",[a("a-icon",{attrs:{type:"eye"}}),t._v(" "+t._s(e.visits)+" ")],1),a("span",{on:{click:function(a){return t.handleShowSheetComments(e)}}},[a("a-icon",{attrs:{type:"message"}}),t._v(" "+t._s(e.commentCount)+" ")],1),a("a-dropdown",{attrs:{trigger:["click"],placement:"topLeft"},scopedSlots:t._u([{key:"overlay",fn:function(){return[a("a-menu",["PUBLISHED"===e.status||"DRAFT"===e.status?a("a-menu-item",{on:{click:function(a){return t.handleEditClick(e)}}},[t._v(" 编辑 ")]):"RECYCLE"===e.status?a("a-menu-item",[a("a-popconfirm",{attrs:{title:"你确定要发布【"+e.title+"】页面？",cancelText:"取消",okText:"确定"},on:{confirm:function(a){return t.handleEditStatusClick(e.id,"PUBLISHED")}}},[t._v(" 还原 ")])],1):t._e(),"PUBLISHED"===e.status||"DRAFT"===e.status?a("a-menu-item",[a("a-popconfirm",{attrs:{title:"你确定要将【"+e.title+"】页面移到回收站？",cancelText:"取消",okText:"确定"},on:{confirm:function(a){return t.handleEditStatusClick(e.id,"RECYCLE")}}},[t._v(" 回收站 ")])],1):"RECYCLE"===e.status?a("a-menu-item",[a("a-popconfirm",{attrs:{title:"你确定要永久删除【"+e.title+"】页面？",cancelText:"取消",okText:"确定"},on:{confirm:function(a){return t.handleDeleteClick(e.id)}}},[t._v(" 删除 ")])],1):t._e(),a("a-menu-item",{on:{click:function(a){return t.handleShowSheetSettings(e)}}},[t._v("设置")])],1)]},proxy:!0}],null,!0)},[a("span",[a("a-icon",{attrs:{type:"bars"}})],1)])]},proxy:!0},{key:"extra",fn:function(){return[a("a-badge",{attrs:{status:t.sheetStatuses[e.status].status,text:t._f("statusText")(e.status)}})]},proxy:!0}],null,!0)},[a("a-list-item-meta",{scopedSlots:t._u([{key:"description",fn:function(){return[t._v(" "+t._s(t._f("moment")(e.createTime))+" ")]},proxy:!0},{key:"title",fn:function(){return[a("div",{staticStyle:{"max-width":"300px",display:"block","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},[e.inProgress?a("a-tooltip",{attrs:{placement:"top",title:"当前有内容已保存，但还未发布。"}},[a("a-icon",{staticClass:"cursor-pointer",staticStyle:{"margin-right":"3px"},attrs:{theme:"twoTone",twoToneColor:"#52c41a",type:"info-circle"},on:{click:function(a){return t.handleEditClick(e)}}})],1):t._e(),"PUBLISHED"===e.status?a("a-tooltip",{attrs:{title:"点击访问【"+e.title+"】",placement:"top"}},[a("a",{staticClass:"no-underline",attrs:{href:e.fullPath,target:"_blank"}},[t._v(" "+t._s(e.title)+" ")])]):"DRAFT"===e.status?a("a-tooltip",{attrs:{title:"点击预览【"+e.title+"】",placement:"top"}},[a("a",{staticClass:"no-underline",attrs:{href:"javascript:void(0);"},on:{click:function(a){return t.handlePreview(e.id)}}},[t._v(" "+t._s(e.title)+" ")])]):a("a-button",{staticClass:"!p-0",attrs:{disabled:"",type:"link"}},[t._v(" "+t._s(e.title)+" ")])],1)]},proxy:!0}],null,!0)}),e.summary?a("div",{staticClass:"block"},[a("span",[t._v(" "+t._s(e.summary)+"... ")])]):t._e()],1)]}}],null,!1,2875890974)}):a("a-table",{attrs:{columns:t.customColumns,dataSource:t.list.data,loading:t.list.loading,pagination:!1,rowKey:function(t){return t.id},scrollToFirstRowOnChange:!0},scopedSlots:t._u([{key:"sheetTitle",fn:function(e,s){return[s.inProgress?a("a-tooltip",{attrs:{placement:"top",title:"当前有内容已保存，但还未发布。"}},[a("a-icon",{staticClass:"cursor-pointer",staticStyle:{"margin-right":"3px"},attrs:{theme:"twoTone",twoToneColor:"#52c41a",type:"info-circle"},on:{click:function(e){return t.handleEditClick(s)}}})],1):t._e(),"PUBLISHED"===s.status?a("a-tooltip",{attrs:{title:"点击访问【"+e+"】",placement:"top"}},[a("a",{staticClass:"no-underline",attrs:{href:s.fullPath,target:"_blank"}},[t._v(" "+t._s(e)+" ")])]):"DRAFT"===s.status?a("a-tooltip",{attrs:{title:"点击预览【"+e+"】",placement:"top"}},[a("a",{staticClass:"no-underline",attrs:{href:"javascript:void(0);"},on:{click:function(e){return t.handlePreview(s.id)}}},[t._v(" "+t._s(e)+" ")])]):a("a-button",{staticClass:"!p-0",attrs:{disabled:"",type:"link"}},[t._v(" "+t._s(e)+" ")])]}},{key:"status",fn:function(e){return[a("a-badge",{attrs:{status:t.sheetStatuses[e].status,text:t._f("statusText")(e)}})]}},{key:"commentCount",fn:function(e,s){return[a("a-badge",{staticClass:"cursor-pointer",attrs:{count:s.commentCount,numberStyle:{backgroundColor:"#f38181"},overflowCount:999,showZero:!0},on:{click:function(e){return t.handleShowSheetComments(s)}}})]}},{key:"visits",fn:function(t){return[a("a-badge",{attrs:{count:t,numberStyle:{backgroundColor:"#00e0ff"},overflowCount:9999,showZero:!0}})]}},{key:"createTime",fn:function(e){return[a("a-tooltip",{attrs:{placement:"top"},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(" "+t._s(t._f("moment")(e))+" ")]},proxy:!0}],null,!0)},[t._v(" "+t._s(t._f("timeAgo")(e))+" ")])]}},{key:"action",fn:function(e,s){return["PUBLISHED"===s.status||"DRAFT"===s.status?a("a-button",{staticClass:"!p-0",attrs:{type:"link"},on:{click:function(e){return t.handleEditClick(s)}}},[t._v(" 编辑 ")]):"RECYCLE"===s.status?a("a-popconfirm",{attrs:{title:"你确定要发布【"+s.title+"】？",cancelText:"取消",okText:"确定"},on:{confirm:function(e){return t.handleEditStatusClick(s.id,"PUBLISHED")}}},[a("a-button",{staticClass:"!p-0",attrs:{type:"link"}},[t._v("还原")])],1):t._e(),a("a-divider",{attrs:{type:"vertical"}}),"PUBLISHED"===s.status||"DRAFT"===s.status?a("a-popconfirm",{attrs:{title:"你确定要将【"+s.title+"】页面移到回收站？",cancelText:"取消",okText:"确定"},on:{confirm:function(e){return t.handleEditStatusClick(s.id,"RECYCLE")}}},[a("a-button",{staticClass:"!p-0",attrs:{type:"link"}},[t._v("回收站")])],1):"RECYCLE"===s.status?a("a-popconfirm",{attrs:{title:"你确定要永久删除【"+s.title+"】页面？",cancelText:"取消",okText:"确定"},on:{confirm:function(e){return t.handleDeleteClick(s.id)}}},[a("a-button",{staticClass:"!p-0",attrs:{type:"link"}},[t._v("删除")])],1):t._e(),a("a-divider",{attrs:{type:"vertical"}}),a("a-button",{staticClass:"!p-0",attrs:{type:"link"},on:{click:function(e){return t.handleShowSheetSettings(s)}}},[t._v("设置")])]}}])}),a("div",{staticClass:"page-wrapper"},[a("a-pagination",{staticClass:"pagination",attrs:{current:t.pagination.page,defaultPageSize:t.pagination.size,pageSizeOptions:["10","20","50","100"],total:t.pagination.total,showLessItems:"",showSizeChanger:""},on:{change:t.handlePageChange,showSizeChange:t.handlePageSizeChange}})],1),a("SheetSettingModal",{attrs:{loading:t.sheetSettingLoading,post:t.selectedSheet,savedCallback:t.onSheetSavedCallback,visible:t.sheetSettingVisible},on:{"update:visible":function(e){t.sheetSettingVisible=e},onClose:function(e){t.selectedSheet={}}},scopedSlots:t._u([{key:"extraFooter",fn:function(){return[a("a-button",{attrs:{disabled:t.selectPreviousButtonDisabled},on:{click:t.handleSelectPrevious}},[t._v(" 上一篇")]),a("a-button",{attrs:{disabled:t.selectNextButtonDisabled},on:{click:t.handleSelectNext}},[t._v(" 下一篇")])]},proxy:!0}])}),a("TargetCommentDrawer",{attrs:{id:t.selectedSheet.id,description:t.selectedSheet.summary,target:"sheets",title:t.selectedSheet.title,visible:t.sheetCommentVisible},on:{close:t.onSheetCommentsClose}})],1)},v=[],y=a(70014),S=a(55659),b=a(78588);const C=[{title:"标题",dataIndex:"title",ellipsis:!0,scopedSlots:{customRender:"sheetTitle"}},{title:"状态",dataIndex:"status",scopedSlots:{customRender:"status"}},{title:"评论量",dataIndex:"commentCount",scopedSlots:{customRender:"commentCount"}},{title:"访问量",dataIndex:"visits",scopedSlots:{customRender:"visits"}},{title:"发布时间",dataIndex:"createTime",scopedSlots:{customRender:"createTime"}},{title:"操作",width:"180px",scopedSlots:{customRender:"action"}}];var k={name:"CustomSheetList",mixins:[r.jB,r.KT],components:{SheetSettingModal:y.Z,TargetCommentDrawer:S.Z},data(){return{customColumns:C,sheetStatuses:b.Zi,list:{data:[],loading:!1,total:0,hasPrevious:!1,hasNext:!1,params:{page:0,size:10}},selectedSheet:{},sheetSettingVisible:!1,sheetSettingLoading:!1,sheetCommentVisible:!1}},computed:{pagination(){return{page:this.list.params.page+1,size:this.list.params.size,total:this.list.total}},selectPreviousButtonDisabled(){const t=this.list.data.findIndex((t=>t.id===this.selectedSheet.id));return 0===t&&!this.list.hasPrevious},selectNextButtonDisabled(){const t=this.list.data.findIndex((t=>t.id===this.selectedSheet.id));return t===this.list.data.length-1&&!this.list.hasNext}},created(){this.handleListSheets()},destroyed(){this.sheetSettingVisible&&(this.sheetSettingVisible=!1)},beforeRouteLeave(t,e,a){this.sheetSettingVisible&&(this.sheetSettingVisible=!1),a()},methods:{async handleListSheets(t=!0){try{t&&(this.list.loading=!0);const{data:e}=await d.Z.sheet.list(this.list.params);this.list.data=e.content,this.list.total=e.total,this.list.hasPrevious=e.hasPrevious,this.list.hasNext=e.hasNext}catch(e){this.$log.error(e)}finally{this.list.loading=!1}},handleEditClick(t){this.$router.push({name:"SheetEdit",query:{sheetId:t.id}})},handleEditStatusClick(t,e){d.Z.sheet.updateStatusById(t,e).then((()=>{this.$message.success("操作成功！")})).finally((()=>{this.handleListSheets()}))},handleDeleteClick(t){d.Z.sheet["delete"](t).then((()=>{this.$message.success("删除成功！")})).finally((()=>{this.handleListSheets()}))},handleShowSheetSettings(t){d.Z.sheet.get(t.id).then((t=>{this.selectedSheet=t.data,this.sheetSettingVisible=!0}))},handleShowSheetComments(t){d.Z.sheet.get(t.id).then((t=>{this.selectedSheet=t.data,this.sheetCommentVisible=!0}))},handlePreview(t){d.Z.sheet.getPreviewLinkById(t).then((t=>{window.open(t,"_blank")}))},handlePageChange(t=1){this.list.params.page=t-1,this.handleListSheets()},handlePageSizeChange(t,e){this.$log.debug(`Current: ${t}, PageSize: ${e}`),this.list.params.page=0,this.list.params.size=e,this.handleListSheets()},onSheetCommentsClose(){this.sheetCommentVisible=!1,this.selectedSheet={},setTimeout((()=>{this.handleListSheets(!1)}),500)},onSheetSavedCallback(){this.handleListSheets(!1)},async handleSelectPrevious(){const t=this.list.data.findIndex((t=>t.id===this.selectedSheet.id));if(t>0){this.sheetSettingLoading=!0;const e=await d.Z.sheet.get(this.list.data[t-1].id);return this.selectedSheet=e.data,void(this.sheetSettingLoading=!1)}if(0===t&&this.list.hasPrevious){this.list.params.page--,await this.handleListPosts(),this.sheetSettingLoading=!0;const t=await d.Z.sheet.get(this.list.data[this.list.data.length-1].id);this.selectedSheet=t.data,this.sheetSettingLoading=!1}},async handleSelectNext(){const t=this.list.data.findIndex((t=>t.id===this.selectedSheet.id));if(t<this.list.data.length-1){this.sheetSettingLoading=!0;const e=await d.Z.sheet.get(this.list.data[t+1].id);return this.selectedSheet=e.data,void(this.sheetSettingLoading=!1)}if(t===this.list.data.length-1&&this.list.hasNext){this.list.params.page++,await this.handleListPosts(),this.sheetSettingLoading=!0;const t=await d.Z.sheet.get(this.list.data[0].id);this.selectedSheet=t.data,this.sheetSettingLoading=!1}}},filters:{statusText(t){return t?b.Zi[t].text:""}}},_=k,x=(0,u.Z)(_,g,v,!1,null,null,null),w=x.exports,T={components:{PageView:l.B4,IndependentSheetList:f,CustomSheetList:w},data(){const t=[{title:"独立页面",icon:"paper-clip",component:"IndependentSheetList",key:"independent"},{title:"自定义页面",icon:"fork",component:"CustomSheetList",key:"custom"}];return{activeKey:t[0].key,panes:t}},beforeRouteEnter(t,e,a){const s=t.query.activeKey;a((t=>{s&&(t.activeKey=s)}))},watch:{activeKey(t){if(t){const e=this.$router.history.current.path;this.$router.push({path:e,query:{activeKey:t}}).catch((t=>t))}}}},E=T,L=(0,u.Z)(E,s,i,!1,null,null,null),P=L.exports},70014:function(t,e,a){a.d(e,{Z:function(){return g}});var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-modal",{attrs:{afterClose:t.onClosed,bodyStyle:{padding:0},maskClosable:!1,width:680,destroyOnClose:""},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(" "+t._s(t.modalTitle)+" "),t.loading?a("a-icon",{attrs:{type:"loading"}}):t._e()]},proxy:!0}]),model:{value:t.modalVisible,callback:function(e){t.modalVisible=e},expression:"modalVisible"}},[a("div",{staticClass:"card-container"},[a("a-tabs",{attrs:{type:"card"}},[a("a-tab-pane",{key:"normal",attrs:{tab:"常规"}},[a("a-form",{attrs:{"label-col":{span:4},"wrapper-col":{span:20},labelAlign:"left"}},[a("a-form-item",{attrs:{label:"页面标题"}},[a("a-input",{model:{value:t.form.model.title,callback:function(e){t.$set(t.form.model,"title",e)},expression:"form.model.title"}})],1),a("a-form-item",{attrs:{help:t.fullPath,label:"页面别名"}},[a("a-input",{scopedSlots:t._u([{key:"addonAfter",fn:function(){return[a("a-popconfirm",{attrs:{"cancel-text":"取消","ok-text":"确定",placement:"left",title:"是否确定根据标题重新生成别名？"},on:{confirm:t.handleGenerateSlug}},[a("a-icon",{staticClass:"cursor-pointer",attrs:{type:"sync"}})],1)]},proxy:!0}]),model:{value:t.form.model.slug,callback:function(e){t.$set(t.form.model,"slug",e)},expression:"form.model.slug"}})],1),a("a-form-item",{attrs:{label:"摘要"}},[a("a-input",{attrs:{autoSize:{minRows:5},placeholder:"如不填写，会从页面中自动截取",type:"textarea"},model:{value:t.form.model.summary,callback:function(e){t.$set(t.form.model,"summary",e)},expression:"form.model.summary"}})],1)],1)],1),a("a-tab-pane",{key:"advanced",attrs:{tab:"高级"}},[a("a-form",{attrs:{"label-col":{span:4},"wrapper-col":{span:20},labelAlign:"left"}},[a("a-form-item",{attrs:{label:"禁止评论"}},[a("a-switch",{model:{value:t.form.model.disallowComment,callback:function(e){t.$set(t.form.model,"disallowComment",e)},expression:"form.model.disallowComment"}})],1),a("a-form-item",{attrs:{label:"发表时间："}},[a("a-date-picker",{attrs:{defaultValue:t.createTimeDefaultValue,format:"YYYY-MM-DD HH:mm:ss",placeholder:"选择页面发表时间",showTime:""},on:{change:t.onCreateTimeSelect,ok:t.onCreateTimeSelect}})],1),a("a-form-item",{attrs:{label:"自定义模板："}},[a("a-select",{model:{value:t.form.model.template,callback:function(e){t.$set(t.form.model,"template",e)},expression:"form.model.template"}},[a("a-select-option",{key:"",attrs:{value:""}},[t._v("无")]),t._l(t.templates,(function(e){return a("a-select-option",{key:e,attrs:{value:e}},[t._v(" "+t._s(e)+" ")])}))],2)],1),a("a-form-item",{attrs:{label:"封面图："}},[a("div",{staticClass:"post-thumb"},[a("a-space",{attrs:{direction:"vertical"}},[a("img",{staticClass:"img",attrs:{src:t.form.model.thumbnail||"/images/placeholder.jpg",alt:"Post cover thumbnail"},on:{click:function(e){t.attachmentSelectVisible=!0}}}),a("a-input",{attrs:{"allow-clear":"",placeholder:"点击封面图选择图片，或者输入外部链接"},model:{value:t.form.model.thumbnail,callback:function(e){t.$set(t.form.model,"thumbnail",e)},expression:"form.model.thumbnail"}})],1)],1)])],1)],1),a("a-tab-pane",{key:"seo",attrs:{tab:"SEO"}},[a("a-form",{attrs:{"label-col":{span:4},"wrapper-col":{span:20},labelAlign:"left"}},[a("a-form-item",{attrs:{label:"自定义关键词"}},[a("a-input",{attrs:{autoSize:{minRows:5},placeholder:"多个关键词以英文逗号隔开",type:"textarea"},model:{value:t.form.model.metaKeywords,callback:function(e){t.$set(t.form.model,"metaKeywords",e)},expression:"form.model.metaKeywords"}})],1),a("a-form-item",{attrs:{label:"自定义描述"}},[a("a-input",{attrs:{autoSize:{minRows:5},placeholder:"如不填写，会从页面中自动截取",type:"textarea"},model:{value:t.form.model.metaDescription,callback:function(e){t.$set(t.form.model,"metaDescription",e)},expression:"form.model.metaDescription"}})],1)],1)],1),a("a-tab-pane",{key:"meta",attrs:{tab:"元数据"}},[a("MetaEditor",{attrs:{metas:t.form.model.metas,targetId:t.form.model.id,target:"sheet"},on:{"update:metas":function(e){return t.$set(t.form.model,"metas",e)}}})],1)],1)],1),a("template",{slot:"footer"},[t._t("extraFooter"),a("a-button",{attrs:{disabled:t.loading},on:{click:function(e){t.modalVisible=!1}}},[t._v(" 关闭")]),t.form.model.id?t._e():a("ReactiveButton",{attrs:{errored:t.form.draftSaveErrored,loading:t.form.draftSaving,erroredText:"保存失败",loadedText:"保存成功",text:"保存草稿",type:"danger"},on:{callback:t.handleSavedCallback,click:function(e){return t.handleCreateOrUpdate("DRAFT")}}}),a("ReactiveButton",{attrs:{errored:t.form.saveErrored,erroredText:(t.form.model.id?"保存":"发布")+"失败",loadedText:(t.form.model.id?"保存":"发布")+"成功",loading:t.form.saving,text:t.form.model.id?"保存":"发布"},on:{callback:t.handleSavedCallback,click:function(e){return t.handleCreateOrUpdate()}}})],2),a("AttachmentSelectModal",{attrs:{multiSelect:!1,visible:t.attachmentSelectVisible},on:{"update:visible":function(e){t.attachmentSelectVisible=e},confirm:t.handleSelectSheetThumbnail}})],2)},i=[],l=a(59563),n=a(3832),o=a(86637),r=a(73511),d=a.n(r),c=a(98906),m=a(1540),h={name:"SheetSettingModal",mixins:[n.jB,n.KT],components:{MetaEditor:l.Z},props:{visible:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},post:{type:Object,default:()=>({})},savedCallback:{type:Function,default:null}},data(){return{form:{model:{},saving:!1,saveErrored:!1,draftSaving:!1,draftSaveErrored:!1},templates:[],attachmentSelectVisible:!1}},computed:{...(0,c.Se)(["options"]),modalVisible:{get(){return this.visible},set(t){this.$emit("update:visible",t)}},modalTitle(){return this.form.model.id?"页面设置":"页面发布"},createTimeDefaultValue(){if(this.form.model.createTime){const t=new Date(this.form.model.createTime);return(0,o._)(t,"YYYY-MM-DD HH:mm:ss")}return(0,o._)(new Date,"YYYY-MM-DD HH:mm:ss")},fullPath(){const t=this.options.sheet_permalink_type,e=this.options.blog_url,a=this.options.sheet_prefix,s=this.options.path_suffix?this.options.path_suffix:"",i=this.form.model.slug||"{slug}";switch(t){case"SECONDARY":return`${e}/${a}/${i}${s}`;case"ROOT":return`${e}/${i}${s}`;default:return""}}},watch:{modalVisible(t){t&&(this.form.model=Object.assign({},this.post),this.form.model.slug||this.form.model.id||this.handleGenerateSlug())},post:{deep:!0,handler(t){this.form.model=Object.assign({},t)}}},created(){this.handleListCustomTemplates()},methods:{async handleCreateOrUpdate(t="PUBLISHED"){if(!this.form.model.title)return void this.$notification["error"]({message:"提示",description:"页面标题不能为空！"});this.form.model.status=t,this.form.model.keepRaw=!0;const{id:e,status:a}=this.form.model;try{this.form["PUBLISHED"===a?"saving":"draftSaving"]=!0,e?await m.Z.sheet.update(e,this.form.model):await m.Z.sheet.create(this.form.model)}catch(s){this.form["PUBLISHED"===a?"saveErrored":"draftSaveErrored"]=!0,this.$log.error(s)}finally{setTimeout((()=>{this.form.saving=!1,this.form.draftSaving=!1}),400)}},handleSavedCallback(){this.form.saveErrored||this.form.draftSaveErrored?(this.form.saveErrored=!1,this.form.draftSaveErrored=!1):this.savedCallback&&this.savedCallback()},async handleListCustomTemplates(){try{const t=await m.Z.theme.listCustomSheetTemplates();this.templates=t.data}catch(t){this.$log.error(t)}},onCreateTimeSelect(t){this.form.model.createTime=t.valueOf()},handleGenerateSlug(){if(this.form.model.title&&d().isSupported()){let t="";const e=d().parse(this.form.model.title.replace(/\s+/g,"").toLowerCase());let a;e.forEach((e=>{if(2===e.type){const s=e.target?e.target.toLowerCase():"";t+=t&&!/\n|\s/.test(a.target)?"-"+s:s}else t+=(a&&2===a.type?"-":"")+e.target;a=e})),this.$set(this.form.model,"slug",t)}},handleSelectSheetThumbnail({raw:t}){t.length&&(this.form.model.thumbnail=encodeURI(t[0].path)),this.attachmentSelectVisible=!1},onClosed(){this.$emit("onClose"),this.$emit("onUpdate",this.form.model)}}},u=h,p=a(18156),f=(0,p.Z)(u,s,i,!1,null,null,null),g=f.exports}}]);