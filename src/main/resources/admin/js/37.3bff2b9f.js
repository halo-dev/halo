"use strict";(self["webpackChunkhalo_admin"]=self["webpackChunkhalo_admin"]||[]).push([[37],{1037:function(a,t,e){e.r(t),e.d(t,{default:function(){return p}});var r=function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",[e("a-row",{attrs:{gutter:12}},[e("a-col",{staticClass:"pb-3",attrs:{lg:10,md:24}},[e("a-card",{attrs:{bodyStyle:{padding:"16px"},bordered:!1}},[e("div",{staticClass:"mb-6 text-center"},[e("a-tooltip",{attrs:{trigger:["hover"],placement:"right",title:"点击可修改头像"}},[e("a-avatar",{staticClass:"cursor-pointer",attrs:{size:104,src:a.userForm.model.avatar||"//cn.gravatar.com/avatar/?s=256&d=mm"},on:{click:a.handleOpenUpdateAvatarForm}})],1),e("div",{staticClass:"mt-4 mb-1 text-xl font-medium leading-5",staticStyle:{color:"rgba(0, 0, 0, 0.85)"}},[a._v(" "+a._s(a.userForm.model.nickname)+" ")]),e("div",[a._v(a._s(a.userForm.model.description))])],1),e("div",[e("p",{staticClass:"mb-3"},[e("a-icon",{staticClass:"mr-3",attrs:{type:"link"}}),e("a",{attrs:{href:a.options.blog_url,target:"method"}},[a._v(a._s(a.options.blog_url))])],1),e("p",{staticClass:"mb-3"},[e("a-icon",{staticClass:"mr-3",attrs:{type:"mail"}}),a._v(" "+a._s(a.userForm.model.email)+" ")],1),e("p",{staticClass:"mb-3"},[e("a-icon",{staticClass:"mr-3",attrs:{type:"calendar"}}),a._v(" "+a._s(a.statistics.data.establishDays||0)+" 天 ")],1)]),e("a-divider"),e("div",[e("a-list",{attrs:{loading:a.statistics.loading,itemLayout:"horizontal"}},[e("a-list-item",[a._v("累计发表了 "+a._s(a.statistics.data.postCount||0)+" 篇文章。")]),e("a-list-item",[a._v("累计创建了 "+a._s(a.statistics.data.categoryCount||0)+" 个分类。")]),e("a-list-item",[a._v("累计创建了 "+a._s(a.statistics.data.tagCount||0)+" 个标签。")]),e("a-list-item",[a._v("累计获得了 "+a._s(a.statistics.data.commentCount||0)+" 条评论。")]),e("a-list-item",[a._v("累计添加了 "+a._s(a.statistics.data.linkCount||0)+" 个友链。")]),e("a-list-item",[a._v("文章总阅读 "+a._s(a.statistics.data.visitCount||0)+" 次。")]),e("a-list-item")],1)],1)],1)],1),e("a-col",{staticClass:"pb-3",attrs:{lg:14,md:24}},[e("a-card",{attrs:{bodyStyle:{padding:"0"},bordered:!1,title:"个人资料"}},[e("div",{staticClass:"card-container"},[e("a-tabs",{attrs:{type:"card"}},[e("a-tab-pane",{key:"1"},[e("span",{attrs:{slot:"tab"},slot:"tab"},[e("a-icon",{attrs:{type:"idcard"}}),a._v("基本资料 ")],1),e("a-form-model",{ref:"userForm",attrs:{model:a.userForm.model,rules:a.userForm.rules,wrapperCol:{xl:{span:15},lg:{span:15},sm:{span:15},xs:{span:24}},layout:"vertical"}},[e("a-form-model-item",{attrs:{label:"用户名：",prop:"username"}},[e("a-input",{model:{value:a.userForm.model.username,callback:function(t){a.$set(a.userForm.model,"username",t)},expression:"userForm.model.username"}})],1),e("a-form-model-item",{attrs:{label:"昵称：",prop:"nickname"}},[e("a-input",{model:{value:a.userForm.model.nickname,callback:function(t){a.$set(a.userForm.model,"nickname",t)},expression:"userForm.model.nickname"}})],1),e("a-form-model-item",{attrs:{label:"电子邮箱：",prop:"email"}},[e("a-input",{model:{value:a.userForm.model.email,callback:function(t){a.$set(a.userForm.model,"email",t)},expression:"userForm.model.email"}})],1),e("a-form-model-item",{attrs:{label:"个人说明：",prop:"description"}},[e("a-input",{attrs:{autoSize:{minRows:5},type:"textarea"},model:{value:a.userForm.model.description,callback:function(t){a.$set(a.userForm.model,"description",t)},expression:"userForm.model.description"}})],1),e("a-form-model-item",[e("ReactiveButton",{attrs:{errored:a.userForm.errored,loading:a.userForm.saving,erroredText:"保存失败",loadedText:"保存成功",text:"保存",type:"primary"},on:{callback:a.handleUpdatedProfileCallback,click:a.handleUpdateProfile}})],1)],1)],1),e("a-tab-pane",{key:"2"},[e("span",{attrs:{slot:"tab"},slot:"tab"},[e("a-icon",{attrs:{type:"lock"}}),a._v("密码 ")],1),e("a-form-model",{ref:"passwordForm",attrs:{model:a.passwordForm.model,rules:a.passwordForm.rules,wrapperCol:{xl:{span:15},lg:{span:15},sm:{span:15},xs:{span:24}},layout:"vertical"}},[e("a-form-model-item",{attrs:{label:"原密码：",prop:"oldPassword"}},[e("a-input-password",{attrs:{autocomplete:"new-password"},model:{value:a.passwordForm.model.oldPassword,callback:function(t){a.$set(a.passwordForm.model,"oldPassword",t)},expression:"passwordForm.model.oldPassword"}})],1),e("a-form-model-item",{attrs:{label:"新密码：",prop:"newPassword"}},[e("a-input-password",{attrs:{autocomplete:"new-password"},model:{value:a.passwordForm.model.newPassword,callback:function(t){a.$set(a.passwordForm.model,"newPassword",t)},expression:"passwordForm.model.newPassword"}})],1),e("a-form-model-item",{attrs:{label:"确认密码：",prop:"confirmPassword"}},[e("a-input-password",{attrs:{autocomplete:"new-password"},model:{value:a.passwordForm.model.confirmPassword,callback:function(t){a.$set(a.passwordForm.model,"confirmPassword",t)},expression:"passwordForm.model.confirmPassword"}})],1),e("a-form-model-item",[e("ReactiveButton",{attrs:{errored:a.passwordForm.errored,loading:a.passwordForm.saving,erroredText:"更改失败",loadedText:"更改成功",text:"确认更改",type:"primary"},on:{callback:a.handleUpdatedPasswordCallback,click:a.handleUpdatePassword}})],1)],1)],1),e("a-tab-pane",{key:"3"},[e("span",{attrs:{slot:"tab"},slot:"tab"},[e("a-icon",{attrs:{type:"safety-certificate"}}),a._v("两步验证 ")],1),e("a-form-model",{attrs:{layout:"vertical"}},[e("a-form-model-item",{attrs:{label:"两步验证："}},[e("a-switch",{attrs:{loading:a.mfaParam.switch.loading},on:{change:a.handleMFASwitch},model:{value:a.mfaParam.switch.checked,callback:function(t){a.$set(a.mfaParam.switch,"checked",t)},expression:"mfaParam.switch.checked"}})],1),e("a-form-model-item",{attrs:{label:"两步验证应用："}},[e("a-list",{attrs:{itemLayout:"horizontal"}},[e("a-list-item",[e("b",[a._v("Authy")]),a._v(" 功能丰富 专为两步验证码 "),e("a-divider",{attrs:{type:"vertical"}}),e("a",{attrs:{href:"https://authy.com/download/",target:"_blank"}},[a._v(" iOS/Android/Windows/Mac/Linux "),e("a-icon",{attrs:{type:"link"}})],1),e("a-divider",{attrs:{type:"vertical"}}),e("a",{attrs:{href:"https://chrome.google.com/webstore/detail/authy/gaedmjdfmmahhbjefcbgaolhhanlaolb?hl=cn",target:"_blank"}},[a._v(" Chrome 扩展 "),e("a-icon",{attrs:{type:"link"}})],1)],1),e("a-list-item",[e("b",[a._v("Google Authenticator")]),a._v(" 简单易用，但不支持密钥导出备份 "),e("a-divider",{attrs:{type:"vertical"}}),e("a",{attrs:{href:"https://apps.apple.com/us/app/google-authenticator/id388497605",target:"_blank"}},[a._v(" iOS "),e("a-icon",{attrs:{type:"link"}})],1),e("a-divider",{attrs:{type:"vertical"}}),e("a",{attrs:{href:"https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&hl=cn",target:"_blank"}},[a._v(" Android "),e("a-icon",{attrs:{type:"link"}})],1)],1),e("a-list-item",[e("b",[a._v("Microsoft Authenticator")]),a._v(" 使用微软全家桶的推荐 "),e("a-divider",{attrs:{type:"vertical"}}),e("a",{attrs:{href:"https://www.microsoft.com/zh-cn/account/authenticator",target:"_blank"}},[a._v(" iOS/Android "),e("a-icon",{attrs:{type:"link"}})],1)],1),e("a-list-item",[e("b",[a._v("1Password")]),a._v(" 强大安全的密码管理付费应用 "),e("a-divider",{attrs:{type:"vertical"}}),e("a",{attrs:{href:"https://1password.com/zh-cn/downloads/",target:"_blank"}},[a._v(" iOS/Android/Windows/Mac/Linux/ChromeOS "),e("a-icon",{attrs:{type:"link"}})],1)],1)],1)],1)],1)],1)],1)],1)])],1)],1),e("a-modal",{attrs:{centered:!0,closable:!1,confirmLoading:!1,destroyOnClose:!0,keyboard:!1,title:a.mfaParam.modal.title,visible:a.mfaParam.modal.visible,width:400,icon:"safety-certificate"},scopedSlots:a._u([{key:"footer",fn:function(){return[e("a-button",{key:"back",on:{click:a.handleCloseMFAuthModal}},[a._v(" 取消")]),e("ReactiveButton",{key:"submit",attrs:{errored:a.mfaParam.errored,loading:a.mfaParam.saving,erroredText:"设置失败",loadedText:"设置成功",text:"确定",type:"primary"},on:{callback:a.handleSetMFAuthCallback,click:a.handleSetMFAuth}})]},proxy:!0}])},[e("a-form-model",{ref:"mfaForm",attrs:{model:a.mfaParam,rules:a.mfaParam.rules,layout:"vertical"}},[a.mfaUsed?e("a-form-model-item",{attrs:{label:"两步验证码",prop:"authcode"}},[e("a-input",{attrs:{maxLength:6},scopedSlots:a._u([{key:"prefix",fn:function(){return[e("a-icon",{staticStyle:{color:"rgba(0, 0, 0, 0.25)"},attrs:{type:"safety-certificate"}})]},proxy:!0}],null,!1,4227117093),model:{value:a.mfaParam.authcode,callback:function(t){a.$set(a.mfaParam,"authcode",t)},expression:"mfaParam.authcode"}})],1):a._e(),a.mfaUsed?a._e():e("a-form-model-item",{attrs:{help:"MFAKey:"+a.mfaParam.mfaKey,label:"1. 请扫描二维码或导入 key"},scopedSlots:a._u([{key:"extra",fn:function(){return[e("span",{staticClass:"text-red-600"},[a._v(" * 建议保存此二维码或 MFAKey，验证设备丢失将无法找回，只能通过重置密码关闭二步验证。 ")])]},proxy:!0}],null,!1,3878319085)},[e("img",{attrs:{src:a.mfaParam.qrImage,width:"100%"}})]),a.mfaUsed?a._e():e("a-form-model-item",{attrs:{label:"2. 验证两步验证码",prop:"authcode"}},[e("a-input",{attrs:{maxLength:6},scopedSlots:a._u([{key:"prefix",fn:function(){return[e("a-icon",{staticStyle:{color:"rgba(0, 0, 0, 0.25)"},attrs:{type:"safety-certificate"}})]},proxy:!0}],null,!1,4227117093),model:{value:a.mfaParam.authcode,callback:function(t){a.$set(a.mfaParam,"authcode",t)},expression:"mfaParam.authcode"}})],1)],1)],1),e("a-modal",{attrs:{title:"修改头像"},scopedSlots:a._u([{key:"footer",fn:function(){return[e("ReactiveButton",{attrs:{errored:a.updateAvatarForm.errored,loading:a.updateAvatarForm.saving,erroredText:"保存失败",loadedText:"保存成功",text:"保存",type:"primary"},on:{callback:a.handleUpdateAvatarCallback,click:a.handleUpdateAvatar}}),e("a-button",{on:{click:function(t){a.updateAvatarForm.visible=!1}}},[a._v("关闭")])]},proxy:!0}]),model:{value:a.updateAvatarForm.visible,callback:function(t){a.$set(a.updateAvatarForm,"visible",t)},expression:"updateAvatarForm.visible"}},[e("a-form",{attrs:{layout:"vertical"}},[e("a-form-item",{attrs:{label:"头像链接："}},[e("AttachmentInput",{ref:"avatarInput",model:{value:a.updateAvatarForm.avatar,callback:function(t){a.$set(a.updateAvatarForm,"avatar",t)},expression:"updateAvatarForm.avatar"}})],1)],1)],1)],1)},s=[],o=e(54288),i=e(22373),l=(e(70315),e(87591),e(31875),e(36591)),m=e(98906),n={data:function(){var a=this,t=function(t,e,r){e&&a.passwordForm.model.newPassword!==e?r(new Error("确认密码与新密码不一致")):r()};return{attachmentSelect:{visible:!1},updateAvatarForm:{avatar:void 0,visible:!1,saving:!1,saveErrored:!1},userForm:{model:{},saving:!1,errored:!1,rules:{username:[{required:!0,message:"* 用户名不能为空",trigger:["change"]},{max:50,message:"* 用户名的字符长度不能超过 50",trigger:["change"]}],nickname:[{required:!0,message:"* 用户昵称不能为空",trigger:["change"]},{max:255,message:"* 用户昵称的字符长度不能超过 255",trigger:["change"]}],email:[{required:!0,message:"* 电子邮箱地址不能为空",trigger:["change"]},{type:"email",message:"* 电子邮箱地址格式不正确",trigger:["change"]},{max:127,message:"* 电子邮箱的字符长度不能超过 127",trigger:["change"]}],description:[{max:1023,message:"* 个人说明的字符长度不能超过 1023",trigger:["change"]}]}},statistics:{data:{},loading:!1},passwordForm:{model:{oldPassword:null,newPassword:null,confirmPassword:null},saving:!1,errored:!1,rules:{oldPassword:[{required:!0,message:"* 原密码不能为空",trigger:["change"]},{max:100,min:8,message:"* 密码的字符长度必须在 8 - 100 之间",trigger:["blur"]}],newPassword:[{required:!0,message:"* 新密码不能为空",trigger:["change"]},{max:100,min:8,message:"* 密码的字符长度必须在 8 - 100 之间",trigger:["change"]}],confirmPassword:[{required:!0,message:"* 确认密码不能为空",trigger:["change"]},{validator:t,trigger:["change"]}]}},mfaParam:{mfaKey:null,mfaType:"NONE",mfaUsed:!1,authcode:null,qrImage:null,modal:{title:"确认开启两步验证？",visible:!1},switch:{loading:!1,checked:!1},rules:{authcode:[{required:!0,message:"* 两步验证码不能为空",trigger:["change"]}]},saving:!1,errored:!1}}},computed:(0,i.Z)((0,i.Z)({},(0,m.Se)(["options"])),{},{mfaType:function(){return this.mfaParam.mfaType},mfaUsed:function(){return this.mfaParam.mfaUsed}}),created:function(){this.handleLoadStatistics()},watch:{mfaType:function(a){a&&(this.mfaParam.mfaUsed="NONE"!==a)},mfaUsed:function(a){this.mfaParam.switch.checked=a}},methods:(0,i.Z)((0,i.Z)({},(0,m.OI)({setUser:"SET_USER"})),{},{handleLoadStatistics:function(){var a=this;this.statistics.loading=!0,l.Z.statistic.statisticsWithUser().then((function(t){a.userForm.model=t.data.user,a.statistics.data=t.data,a.mfaParam.mfaType=a.userForm.model.mfaType&&a.userForm.model.mfaType})).finally((function(){a.statistics.loading=!1}))},handleUpdatePassword:function(){var a=this,t=this;t.$refs.passwordForm.validate((function(t){t&&(a.passwordForm.saving=!0,l.Z.user.updatePassword(a.passwordForm.model).catch((function(){a.passwordForm.errored=!0})).finally((function(){setTimeout((function(){a.passwordForm.saving=!1}),400)})))}))},handleUpdatedPasswordCallback:function(){this.passwordForm.errored?this.passwordForm.errored=!1:(this.passwordForm.model.oldPassword=null,this.passwordForm.model.newPassword=null,this.passwordForm.model.confirmPassword=null)},handleUpdateProfile:function(){var a=this,t=this;t.$refs.userForm.validate((function(t){t&&(a.userForm.saving=!0,l.Z.user.updateProfile(a.userForm.model).then((function(t){a.userForm.model=t.data,a.setUser(Object.assign({},a.userForm.model))})).catch((function(){a.userForm.errored=!0})).finally((function(){setTimeout((function(){a.userForm.saving=!1}),400)})))}))},handleUpdatedProfileCallback:function(){this.userForm.errored&&(this.userForm.errored=!1)},handleMFASwitch:function(a){var t=this;this.mfaParam.switch.loading=!0,!a&&this.mfaUsed?(this.mfaParam.modal.title="确认关闭两步验证？",this.mfaParam.modal.visible=!0):(this.mfaParam.modal.title="确认开启两步验证？",l.Z.user.generateMFAQrImage({mfaType:"TFA_TOTP"}).then((function(a){t.mfaParam.mfaKey=a.data.mfaKey,t.mfaParam.qrImage=a.data.qrImage,t.mfaParam.modal.visible=!0})).catch((function(){t.mfaParam.switch.loading=!1})))},handleSetMFAuth:function(){var a=this,t=a.mfaUsed?"NONE":"TFA_TOTP";a.$refs.mfaForm.validate((function(e){e&&(a.mfaParam.saving=!0,l.Z.user.updateMFAuth({mfaType:t,mfaKey:a.mfaParam.mfaKey,authcode:a.mfaParam.authcode}).catch((function(){a.mfaParam.errored=!0})).finally((function(){setTimeout((function(){a.mfaParam.saving=!1}),400)})))}))},handleSetMFAuthCallback:function(){this.mfaParam.errored?this.mfaParam.errored=!1:(this.handleCloseMFAuthModal(),this.handleLoadStatistics(),this.$message.success(this.mfaUsed?"两步验证已关闭！":"两步验证已开启,下次登录生效！"))},handleCloseMFAuthModal:function(){this.mfaParam.modal.visible=!1,this.mfaParam.switch.loading=!1,this.mfaParam.switch.checked=this.mfaUsed,this.mfaParam.authcode=null,this.mfaParam.qrImage=null,this.mfaParam.mfaKey=null},handleOpenUpdateAvatarForm:function(){var a=this;this.updateAvatarForm.avatar=this.userForm.model.avatar,this.updateAvatarForm.visible=!0,this.$nextTick((function(){a.$refs.avatarInput.focus()}))},handleUpdateAvatar:function(){var a=this;return(0,o.Z)(regeneratorRuntime.mark((function t(){var e,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,l.Z.user.getProfile();case 2:e=t.sent,r=e.data,r.avatar=a.updateAvatarForm.avatar,a.updateAvatarForm.saving=!0,l.Z.user.updateProfile(r).catch((function(){a.updateAvatarForm.saveErrored=!0})).finally((function(){setTimeout((function(){a.updateAvatarForm.saving=!1}),400),a.handleLoadStatistics()}));case 7:case"end":return t.stop()}}),t)})))()},handleUpdateAvatarCallback:function(){this.updateAvatarForm.saveErrored?this.updateAvatarForm.saveErrored=!1:this.updateAvatarForm.visible=!1}})},d=n,c=e(70739),u=(0,c.Z)(d,r,s,!1,null,null,null),p=u.exports}}]);