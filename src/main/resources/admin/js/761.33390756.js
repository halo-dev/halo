"use strict";(self["webpackChunkhalo_admin"]=self["webpackChunkhalo_admin"]||[]).push([[761],{34761:function(e,t,a){a.r(t),a.d(t,{default:function(){return u}});var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("page-view",[a("a-row",{attrs:{gutter:12,align:"middle",type:"flex"}},[a("a-col",{staticClass:"pb-3",attrs:{span:24}},[a("a-card",{attrs:{bodyStyle:{padding:"16px"},bordered:!1}},[a("div",{staticClass:"table-page-search-wrapper"},[a("a-form",{attrs:{layout:"inline"}},[a("a-row",{attrs:{gutter:48}},[a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{attrs:{label:"关键词："}},[a("a-input",{model:{value:e.list.queryParam.keyword,callback:function(t){e.$set(e.list.queryParam,"keyword",t)},expression:"list.queryParam.keyword"}})],1)],1),a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{attrs:{label:"分组："}},[a("a-select",{on:{change:function(t){return e.handleQuery()}},model:{value:e.list.queryParam.team,callback:function(t){e.$set(e.list.queryParam,"team",t)},expression:"list.queryParam.team"}},e._l(e.computedTeams,(function(t,o){return a("a-select-option",{key:o,attrs:{value:t}},[e._v(e._s(t)+" ")])})),1)],1)],1),a("a-col",{attrs:{md:6,sm:24}},[a("span",{staticClass:"table-page-search-submitButtons"},[a("a-space",[a("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleQuery()}}},[e._v("查询")]),a("a-button",{on:{click:function(t){return e.handleResetParam()}}},[e._v("重置")])],1)],1)])],1)],1)],1),a("div",{staticClass:"mb-0 table-operator"},[a("a-button",{attrs:{icon:"plus",type:"primary"},on:{click:function(t){e.form.visible=!0}}},[e._v("添加")])],1)])],1),a("a-col",{attrs:{span:24}},[a("a-list",{attrs:{dataSource:e.list.data,grid:{gutter:12,xs:2,sm:2,md:4,lg:6,xl:6,xxl:6},loading:e.list.loading},scopedSlots:e._u([{key:"renderItem",fn:function(t,o){return a("a-list-item",{key:o},[a("a-card",{attrs:{bodyStyle:{padding:0},hoverable:""},on:{click:function(a){return e.handleOpenEditForm(t)}}},[a("div",{staticClass:"photo-thumb"},[a("img",{attrs:{src:t.thumbnail,loading:"lazy"}})]),a("a-card-meta",{staticClass:"p-3"},[a("ellipsis",{attrs:{slot:"description",length:e.isMobile()?12:16,tooltip:""},slot:"description"},[e._v(e._s(t.name))])],1)],1)],1)}}])})],1)],1),a("div",{staticClass:"page-wrapper"},[a("a-pagination",{attrs:{current:e.list.pagination.page,defaultPageSize:e.list.pagination.size,pageSizeOptions:["18","36","54","72","90","108"],total:e.list.pagination.total,showLessItems:"",showSizeChanger:""},on:{change:e.handlePaginationChange,showSizeChange:e.handlePaginationChange}})],1),a("div",{staticStyle:{position:"fixed",bottom:"30px",right:"30px"}},[a("a-button",{attrs:{icon:"setting",shape:"circle",size:"large",type:"primary"},on:{click:function(t){e.optionFormVisible=!0}}})],1),a("a-modal",{attrs:{afterClose:function(){return e.optionFormVisible=!1},title:"页面设置"},model:{value:e.optionFormVisible,callback:function(t){e.optionFormVisible=t},expression:"optionFormVisible"}},[a("template",{slot:"footer"},[a("a-button",{key:"submit",attrs:{type:"primary"},on:{click:function(t){return e.handleSaveOptions()}}},[e._v("保存")])],1),a("a-form",{attrs:{layout:"vertical"}},[a("a-form-item",{attrs:{help:"* 需要主题进行适配",label:"页面标题："}},[a("a-input",{model:{value:e.options.photos_title,callback:function(t){e.$set(e.options,"photos_title",t)},expression:"options.photos_title"}})],1),a("a-form-item",{attrs:{label:"每页显示条数："}},[a("a-input-number",{staticStyle:{width:"100%"},model:{value:e.options.photos_page_size,callback:function(t){e.$set(e.options,"photos_page_size",t)},expression:"options.photos_page_size"}})],1)],1)],2),a("a-drawer",{attrs:{title:"图片"+(e.form.model.id?"修改":"添加"),visible:e.form.visible,width:e.isMobile()?"100%":"480",closable:"",destroyOnClose:""},on:{close:e.onDrawerClose}},[a("a-form-model",{ref:"photoForm",attrs:{model:e.form.model,rules:e.form.rules,layout:"vertical"}},[a("a-form-model-item",{attrs:{label:"图片地址：",prop:"url"}},[a("div",{staticClass:"pb-2"},[a("img",{staticClass:"w-full cursor-pointer",staticStyle:{"border-radius":"4px"},attrs:{src:e.form.model.url||"/images/placeholder.jpg"},on:{click:function(t){e.attachmentSelectModal.visible=!0}}})]),a("a-input",{attrs:{placeholder:"点击封面图选择图片，或者输入外部链接"},model:{value:e.form.model.url,callback:function(t){e.$set(e.form.model,"url",t)},expression:"form.model.url"}})],1),a("a-form-model-item",{attrs:{label:"缩略图地址：",prop:"thumbnail"}},[a("a-input",{model:{value:e.form.model.thumbnail,callback:function(t){e.$set(e.form.model,"thumbnail",t)},expression:"form.model.thumbnail"}})],1),a("a-form-model-item",{attrs:{label:"图片名称：",prop:"name"}},[a("a-input",{model:{value:e.form.model.name,callback:function(t){e.$set(e.form.model,"name",t)},expression:"form.model.name"}})],1),a("a-form-model-item",{attrs:{label:"拍摄日期：",prop:"takeTime"}},[a("a-date-picker",{staticStyle:{width:"100%"},attrs:{defaultValue:e.takeTimeDefaultValue,format:"YYYY-MM-DD HH:mm:ss",showTime:""},on:{change:e.onTakeTimeChange,ok:e.onTakeTimeSelect}})],1),a("a-form-model-item",{attrs:{label:"拍摄地点：",prop:"location"}},[a("a-input",{model:{value:e.form.model.location,callback:function(t){e.$set(e.form.model,"location",t)},expression:"form.model.location"}})],1),a("a-form-model-item",{attrs:{label:"分组：",prop:"team"}},[a("a-auto-complete",{staticStyle:{width:"100%"},attrs:{dataSource:e.computedTeams,allowClear:""},model:{value:e.form.model.team,callback:function(t){e.$set(e.form.model,"team",t)},expression:"form.model.team"}})],1),a("a-form-model-item",{attrs:{label:"描述：",prop:"description"}},[a("a-input",{attrs:{autoSize:{minRows:5},type:"textarea"},model:{value:e.form.model.description,callback:function(t){e.$set(e.form.model,"description",t)},expression:"form.model.description"}})],1)],1),a("a-divider",{staticClass:"divider-transparent"}),a("div",{staticClass:"bottom-control"},[a("a-space",[a("ReactiveButton",{attrs:{errored:e.form.saveErrored,erroredText:(e.form.model.id?"修改":"添加")+"失败",loadedText:(e.form.model.id?"修改":"添加")+"成功",loading:e.form.saving,text:e.form.model.id?"修改":"添加"},on:{callback:e.handleCreateOrUpdateCallback,click:e.handleCreateOrUpdate}}),e.form.model.id?a("a-popconfirm",{attrs:{cancelText:"取消",okText:"确定",title:"你确定要删除该图片？"},on:{confirm:e.handleDelete}},[a("ReactiveButton",{attrs:{errored:e.form.deleteErrored,loading:e.form.deleting,erroredText:"删除失败",loadedText:"删除成功",text:"删除",type:"danger"},on:{callback:e.handleDeleteCallback,click:function(){}}})],1):e._e()],1)],1),a("AttachmentSelectModal",{attrs:{multiSelect:!1,visible:e.attachmentSelectModal.visible},on:{"update:visible":function(t){return e.$set(e.attachmentSelectModal,"visible",t)},confirm:e.handleAttachmentSelected}})],1)],1)},i=[],l=a(50990),s=a(98906),r=a(3832),n=a(1540),m=a(86637),d={mixins:[r.jB,r.KT],components:{PageView:l.B4},data(){return{list:{data:[],loading:!1,pagination:{page:1,size:18,sort:null,total:1},queryParam:{page:0,size:18,sort:null,keyword:null,team:null}},form:{model:{},visible:!1,rules:{url:[{required:!0,message:"* 图片地址不能为空",trigger:["change"]}],thumbnail:[{required:!0,message:"* 缩略图地址不能为空",trigger:["change"]}],name:[{required:!0,message:"* 图片名称不能为空",trigger:["change"]}]},saving:!1,saveErrored:!1,deleting:!1,deleteErrored:!1},attachmentSelectModal:{visible:!1},optionFormVisible:!1,teams:[],options:[]}},created(){this.handleListPhotos(),this.handleListPhotoTeams(),this.handleListOptions()},computed:{takeTimeDefaultValue(){if(this.form.model.takeTime){const e=new Date(this.form.model.takeTime);return(0,m._)(e,"YYYY-MM-DD HH:mm:ss")}return(0,m._)(new Date,"YYYY-MM-DD HH:mm:ss")},computedTeams(){return this.teams.filter((e=>""!==e))}},methods:{...(0,s.nv)(["refreshOptionsCache"]),handleListPhotos(){this.list.loading=!0,this.list.queryParam.page=this.list.pagination.page-1,this.list.queryParam.size=this.list.pagination.size,this.list.queryParam.sort=this.list.pagination.sort,n.Z.photo.list(this.list.queryParam).then((e=>{this.list.data=e.data.content,this.list.pagination.total=e.data.total})).finally((()=>{this.list.loading=!1}))},handleQuery(){this.handlePaginationChange(1,this.list.pagination.size)},handleListOptions(){n.Z.option.list().then((e=>{this.options=e.data}))},handleListPhotoTeams(){n.Z.photo.listTeams().then((e=>{this.teams=e.data}))},handleCreateOrUpdate(){const e=this;e.$refs.photoForm.validate((t=>{t&&(e.form.saving=!0,e.form.model.id?n.Z.photo.update(e.form.model.id,e.form.model).catch((()=>{e.form.saveErrored=!0})).finally((()=>{setTimeout((()=>{e.form.saving=!1}),400)})):n.Z.photo.create(e.form.model).catch((()=>{e.form.saveErrored=!0})).finally((()=>{setTimeout((()=>{e.form.saving=!1}),400)})))}))},handleCreateOrUpdateCallback(){this.form.saveErrored?this.form.saveErrored=!1:(this.form.model={},this.form.visible=!1,this.handleListPhotos(),this.handleListPhotoTeams())},handleOpenEditForm(e){this.form.model=e,this.form.visible=!0},handlePaginationChange(e,t){this.$log.debug(`Current: ${e}, PageSize: ${t}`),this.list.pagination.page=e,this.list.pagination.size=t,this.handleListPhotos()},handleDelete(){this.form.deleting=!0,n.Z.photo["delete"](this.form.model.id).catch((()=>{this.form.deleteErrored=!0})).finally((()=>{setTimeout((()=>{this.form.deleting=!1}),400)}))},handleDeleteCallback(){this.form.deleteErrored?this.form.deleteErrored=!1:(this.form.model={},this.form.visible=!1,this.handleListPhotos(),this.handleListPhotoTeams())},handleAttachmentSelected({raw:e}){e.length&&(this.form.model.url=encodeURI(e[0].path),this.form.model.thumbnail=encodeURI(e[0].thumbPath)),this.attachmentSelectModal.visible=!1},handleResetParam(){this.list.queryParam.keyword=null,this.list.queryParam.team=null,this.handlePaginationChange(1,this.list.pagination.size),this.handleListPhotoTeams()},onDrawerClose(){this.form.visible=!1,this.form.model={}},handleSaveOptions(){n.Z.option.save(this.options).then((()=>{this.$message.success("保存成功！"),this.optionFormVisible=!1})).finally((()=>{this.handleListOptions(),this.refreshOptionsCache()}))},onTakeTimeChange(e){this.form.model.takeTime=e.valueOf()},onTakeTimeSelect(e){this.form.model.takeTime=e.valueOf()}}},c=d,h=a(18156),p=(0,h.Z)(c,o,i,!1,null,null,null),u=p.exports}}]);