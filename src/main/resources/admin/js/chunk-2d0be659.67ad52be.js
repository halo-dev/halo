(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0be659"],{"2fa0":function(e,t,o){"use strict";o.r(t);var n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"option-tab-wrapper"},[o("a-card",{attrs:{bodyStyle:{padding:0},bordered:!1}},[o("div",{staticClass:"table-operator"},[o("a-button",{attrs:{icon:"cloud-upload",type:"primary"},on:{click:function(t){e.uploadModal.visible=!0}}},[e._v("上传")]),o("a-button",{attrs:{icon:"plus"},on:{click:function(t){return e.handleOpenCreateDirectoryModal({})}}},[e._v(" 新建文件夹 ")]),o("a-button",{attrs:{loading:e.list.loading,icon:"sync"},on:{click:e.handleListStatics}},[e._v(" 刷新 ")])],1),o("div",{staticClass:"mt-4"},[o("a-table",{attrs:{columns:e.list.columns,dataSource:e.sortedStatics,loading:e.list.loading,pagination:!1,rowKey:function(e){return e.id},size:"middle"},scopedSlots:e._u([{key:"name",fn:function(t){return o("span",{},[o("ellipsis",{attrs:{length:64,tooltip:""}},[e._v(" "+e._s(t)+" ")])],1)}},{key:"createTime",fn:function(t){return o("span",{},[e._v(" "+e._s(e._f("moment")(t))+" ")])}},{key:"action",fn:function(t,n){return o("span",{},[n.isFile?o("a",{attrs:{href:e.options.blog_url+n.relativePath,target:"_blank"}},[e._v("访问")]):o("a",{attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.handleUpload(n)}}},[e._v("上传")]),o("a-divider",{attrs:{type:"vertical"}}),o("a-dropdown",{attrs:{trigger:["click"]}},[o("a",{staticClass:"ant-dropdown-link",attrs:{href:"javascript:void(0);"}},[e._v("更多")]),o("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[n.isFile?e._e():o("a-menu-item",{key:"1"},[o("a",{attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.handleOpenCreateDirectoryModal(n)}}},[e._v("创建文件夹")])]),o("a-menu-item",{key:"2"},[o("a-popconfirm",{attrs:{title:n.isFile?"你确定要删除该文件？":"你确定要删除该文件夹？",cancelText:"取消",okText:"确定"},on:{confirm:function(t){return e.handleDelete(n.relativePath)}}},[o("a",{attrs:{href:"javascript:void(0);"}},[e._v("删除")])])],1),o("a-menu-item",{key:"3"},[o("a",{attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.handleOpenRenameModal(n)}}},[e._v("重命名")])]),n.isFile?o("a-menu-item",{key:"4"},[o("a",{attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.handleOpenEditContentModal(n)}}},[e._v("编辑")])]):e._e()],1)],1)],1)}}])})],1)]),o("a-modal",{attrs:{afterClose:e.onUploadModalClose,footer:null,destroyOnClose:"",title:"上传文件"},model:{value:e.uploadModal.visible,callback:function(t){e.$set(e.uploadModal,"visible",t)},expression:"uploadModal.visible"}},[o("FilePondUpload",{ref:"upload",attrs:{filed:e.list.selected.relativePath,uploadHandler:e.uploadModal.uploadHandler,name:"file"}})],1),o("a-modal",{attrs:{afterClose:e.onDirectoryFormModalClose,title:"创建文件夹"},model:{value:e.directoryForm.visible,callback:function(t){e.$set(e.directoryForm,"visible",t)},expression:"directoryForm.visible"}},[o("template",{slot:"footer"},[o("ReactiveButton",{attrs:{errored:e.directoryForm.saveErrored,loading:e.directoryForm.saving,erroredText:"创建失败",loadedText:"创建成功",text:"创建"},on:{callback:e.handleCreateDirectoryCallback,click:e.handleCreateDirectory}})],1),o("a-form-model",{ref:"directoryForm",attrs:{model:e.directoryForm.model,rules:e.directoryForm.rules,layout:"vertical"}},[o("a-form-model-item",{attrs:{label:"文件夹名：",prop:"name"}},[o("a-input",{ref:"createDirectoryInput",on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleCreateDirectory.apply(null,arguments)}},model:{value:e.directoryForm.model.name,callback:function(t){e.$set(e.directoryForm.model,"name",t)},expression:"directoryForm.model.name"}})],1)],1)],2),o("a-modal",{attrs:{afterClose:e.onRenameModalClose,title:"重命名"},model:{value:e.renameForm.visible,callback:function(t){e.$set(e.renameForm,"visible",t)},expression:"renameForm.visible"}},[o("template",{slot:"footer"},[o("ReactiveButton",{attrs:{errored:e.renameForm.saveErrored,loading:e.renameForm.saving,erroredText:"重命名失败",loadedText:"重命名成功",text:"重命名"},on:{callback:e.handleRenameDirectoryOrFileCallback,click:e.handleRenameDirectoryOrFile}})],1),o("a-form-model",{ref:"renameForm",attrs:{model:e.renameForm.model,rules:e.renameForm.rules,layout:"vertical"}},[o("a-form-model-item",{attrs:{label:e.list.selected.isFile?"文件名：":"文件夹名：",prop:"name"}},[o("a-input",{ref:"renameModalInput",on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleRenameDirectoryOrFile.apply(null,arguments)}},model:{value:e.renameForm.model.name,callback:function(t){e.$set(e.renameForm.model,"name",t)},expression:"renameForm.model.name"}})],1)],1)],2),o("a-modal",{staticStyle:{"max-width":"1000px"},attrs:{closable:!1,keyboard:!1,maskClosable:!1,title:"编辑文件",width:"80%"},model:{value:e.editContentForm.visible,callback:function(t){e.$set(e.editContentForm,"visible",t)},expression:"editContentForm.visible"}},[o("template",{slot:"footer"},[o("a-popconfirm",{attrs:{cancelText:"取消",okText:"确定",title:"未保存的内容将会丢失，确定要退出吗？"},on:{confirm:e.handleEditContentModalClose}},[o("a-button",[e._v("取消")])],1),o("ReactiveButton",{attrs:{errored:e.editContentForm.saveErrored,loading:e.editContentForm.saving,erroredText:"保存失败",loadedText:"保存成功",text:"保存"},on:{callback:e.handleContentEditCallback,click:e.handleContentEdit}})],1),o("a-form",{attrs:{layout:"vertical"}},[o("a-form-item",[o("Codemirror",{ref:"editor",attrs:{height:"600px"},model:{value:e.editContentForm.model.content,callback:function(t){e.$set(e.editContentForm.model,"content",t)},expression:"editContentForm.model.content"}})],1)],1)],2)],1)},r=[],a=(o("7ad2"),o("7c02"),o("0277"),o("436f"),o("8354"),o("6249"),o("00aa")),i=o("6c71"),l=o("9efd"),s="/api/admin/statics",d={list:function(){return Object(l["a"])({url:s,method:"get"})},delete:function(e){return Object(l["a"])({url:s,params:{path:e},method:"delete"})},createFolder:function(e,t){return Object(l["a"])({url:s,params:{basePath:e,folderName:t},method:"post"})},upload:function(e,t,o,n){return Object(l["a"])({url:"".concat(s,"/upload"),timeout:864e4,data:e,params:{basePath:n},onUploadProgress:t,cancelToken:o,method:"post"})},rename:function(e,t){return Object(l["a"])({url:"".concat(s,"/rename"),params:{basePath:e,newName:t},method:"post"})},getContent:function(e){return Object(l["a"])({url:"".concat(e),method:"get"})},save:function(e,t){return Object(l["a"])({url:"".concat(s,"/files"),data:{path:e,content:t},method:"put"})}},c=d,m=o("a15c");function u(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function h(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?u(Object(o),!0).forEach((function(t){Object(a["a"])(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):u(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var f=[{title:"文件名",dataIndex:"name",scopedSlots:{customRender:"name"}},{title:"文件类型",dataIndex:"mimeType",scopedSlots:{customRender:"mimeType"}},{title:"上传时间",dataIndex:"createTime",width:"200px",scopedSlots:{customRender:"createTime"}},{title:"操作",dataIndex:"action",width:"120px",scopedSlots:{customRender:"action"}}],p={components:{Codemirror:m["a"]},name:"StaticStorage",data:function(){return{list:{columns:f,data:[],loading:!1,selected:{}},uploadModal:{visible:!1,uploadHandler:c.upload},directoryForm:{model:{name:null},visible:!1,saving:!1,saveErrored:!1,rules:{name:[{required:!0,message:"* 文件夹名不能为空",trigger:["change"]}]}},renameForm:{model:{name:null},visible:!1,saving:!1,saveErrored:!1,rules:{name:[{required:!0,message:"* 文件夹名不能为空",trigger:["change"]}]}},editContentForm:{model:{content:null},visible:!1,saving:!1,saveErrored:!1}}},beforeMount:function(){this.handleListStatics()},computed:h(h({},Object(i["c"])(["options"])),{},{sortedStatics:function(){var e=this.list.data.slice(0);return e.sort((function(e,t){return e.isFile-t.isFile}))}}),methods:{handleListStatics:function(){var e=this;this.list.loading=!0,c.list().then((function(t){e.list.data=t.data.data})).finally((function(){e.list.loading=!1}))},handleDelete:function(e){var t=this;c.delete(e).then((function(){t.$message.success("删除成功！")})).finally((function(){t.handleListStatics()}))},handleUpload:function(e){this.list.selected=e,this.uploadModal.visible=!0},handleOpenCreateDirectoryModal:function(e){var t=this;this.list.selected=e,this.directoryForm.visible=!0,this.$nextTick((function(){t.$refs.createDirectoryInput.focus()}))},handleCreateDirectory:function(){var e=this;this.$refs.directoryForm.validate((function(t){t&&(e.directoryForm.saving=!0,c.createFolder(e.list.selected.relativePath,e.directoryForm.model.name).catch((function(){e.directoryForm.saveErrored=!0})).finally((function(){setTimeout((function(){e.directoryForm.saving=!1}),400)})))}))},handleCreateDirectoryCallback:function(){this.directoryForm.saveErrored?this.directoryForm.saveErrored=!1:(this.directoryForm.model={},this.directoryForm.visible=!1,this.handleListStatics())},handleOpenRenameModal:function(e){var t=this;this.list.selected=e,this.$set(this.renameForm.model,"name",e.name),this.renameForm.visible=!0,this.$nextTick((function(){var e=t.$refs.renameModalInput,o=e.value.split(".");e.focus(),o.length<=1?e.$el.setSelectionRange(0,e.value.length):e.$el.setSelectionRange(0,e.value.length-o.pop().length-1)}))},handleRenameDirectoryOrFile:function(){var e=this;this.$refs.renameForm.validate((function(t){t&&(e.renameForm.saving=!0,c.rename(e.list.selected.relativePath,e.renameForm.model.name).catch((function(){e.renameForm.saveErrored=!0})).finally((function(){setTimeout((function(){e.renameForm.saving=!1}),400)})))}))},handleRenameDirectoryOrFileCallback:function(){this.renameForm.saveErrored?this.renameForm.saveErrored=!1:(this.renameForm.model={},this.renameForm.visible=!1,this.handleListStatics())},handleOpenEditContentModal:function(e){var t=this;this.list.selected=e,c.getContent(this.options.blog_url+e.relativePath).then((function(e){t.editContentForm.model.content=e.data,t.editContentForm.visible=!0,t.$nextTick((function(){t.$refs.editor.handleInitCodemirror()}))}))},handleContentEdit:function(){var e=this;this.editContentForm.saving=!0,c.save(this.list.selected.relativePath,this.editContentForm.model.content).catch((function(){e.editContentForm.saveErrored=!0})).finally((function(){setTimeout((function(){e.editContentForm.saving=!1}),400)}))},handleContentEditCallback:function(){this.editContentForm.saveErrored?this.editContentForm.saveErrored=!1:(this.editContentForm.model={},this.editContentForm.visible=!1,this.handleListStatics())},onDirectoryFormModalClose:function(){this.list.selected={},this.$set(this.directoryForm.model,"name",null)},onRenameModalClose:function(){this.list.selected={},this.$set(this.renameForm.model,"name",null)},onUploadModalClose:function(){this.$refs.upload.handleClearFileList(),this.list.selected={},this.handleListStatics()},handleEditContentModalClose:function(){this.editContentForm.visible=!1,this.list.selected={},this.editContentForm.model.content=""}}},v=p,y=o("bdd7"),b=Object(y["a"])(v,n,r,!1,null,null,null);t["default"]=b.exports}}]);