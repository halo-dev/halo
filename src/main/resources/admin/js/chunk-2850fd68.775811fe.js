(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2850fd68"],{"306f":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("a-row",{staticClass:"h-screen",attrs:{type:"flex",justify:"center",align:"middle"}},[r("a-col",{attrs:{xxl:8,xl:12,lg:16,md:20,sm:20,xs:23}},[r("div",{staticClass:"card-container animated fadeIn"},[r("a-card",{staticStyle:{"box-shadow":"rgba(99, 99, 99, 0.2) 0 2px 8px 0"},attrs:{bordered:!1}},[r("div",{staticClass:"halo-logo"},[r("span",[e._v("Halo "),r("small",[e._v("安装向导")])])]),r("a-alert",{attrs:{message:"欢迎使用 Halo，您正在安装的是 Halo "+e.VERSION+"。",type:"success","show-icon":""}}),r("div",{staticClass:"mt-5 mb-5"},[r("a-radio-group",{model:{value:e.installationMode,callback:function(t){e.installationMode=t},expression:"installationMode"}},[r("a-radio-button",{attrs:{value:"new"}},[e._v(" 全新安装 ")]),r("a-radio-button",{attrs:{value:"import"}},[e._v(" 数据导入 ")])],1)],1),r("a-form-model",{directives:[{name:"show",rawName:"v-show",value:e.isInstallMode,expression:"isInstallMode"}],ref:"installationForm",staticClass:"installationForm animated fadeIn",attrs:{model:e.form.model,rules:e.form.rules,layout:"horizontal"}},[r("a-divider",{attrs:{orientation:"left",dashed:""}},[e._v(" 管理员信息 ")]),r("a-form-model-item",{attrs:{prop:"username"}},[r("a-input",{attrs:{placeholder:"用户名"},model:{value:e.form.model.username,callback:function(t){e.$set(e.form.model,"username",t)},expression:"form.model.username"}},[r("a-icon",{staticStyle:{color:"rgba(0,0,0,.25)"},attrs:{slot:"prefix",type:"user"},slot:"prefix"})],1)],1),r("a-form-model-item",{attrs:{prop:"username"}},[r("a-input",{attrs:{placeholder:"用户昵称"},model:{value:e.form.model.nickname,callback:function(t){e.$set(e.form.model,"nickname",t)},expression:"form.model.nickname"}},[r("a-icon",{staticStyle:{color:"rgba(0,0,0,.25)"},attrs:{slot:"prefix",type:"user"},slot:"prefix"})],1)],1),r("a-form-model-item",{attrs:{prop:"email"}},[r("a-input",{attrs:{placeholder:"用户邮箱"},model:{value:e.form.model.email,callback:function(t){e.$set(e.form.model,"email",t)},expression:"form.model.email"}},[r("a-icon",{staticStyle:{color:"rgba(0,0,0,.25)"},attrs:{slot:"prefix",type:"mail"},slot:"prefix"})],1)],1),r("a-form-model-item",{attrs:{prop:"password"}},[r("a-input",{attrs:{type:"password",placeholder:"登录密码（8-100位）"},model:{value:e.form.model.password,callback:function(t){e.$set(e.form.model,"password",t)},expression:"form.model.password"}},[r("a-icon",{staticStyle:{color:"rgba(0,0,0,.25)"},attrs:{slot:"prefix",type:"lock"},slot:"prefix"})],1)],1),r("a-form-model-item",{attrs:{prop:"confirmPassword"}},[r("a-input",{attrs:{type:"password",placeholder:"确认登录密码"},model:{value:e.form.model.confirmPassword,callback:function(t){e.$set(e.form.model,"confirmPassword",t)},expression:"form.model.confirmPassword"}},[r("a-icon",{staticStyle:{color:"rgba(0,0,0,.25)"},attrs:{slot:"prefix",type:"lock"},slot:"prefix"})],1)],1),r("a-divider",{attrs:{orientation:"left",dashed:""}},[e._v(" 站点信息 ")]),r("a-form-model-item",{attrs:{prop:"url"}},[r("a-input",{attrs:{placeholder:"博客地址"},model:{value:e.form.model.url,callback:function(t){e.$set(e.form.model,"url",t)},expression:"form.model.url"}},[r("a-icon",{staticStyle:{color:"rgba(0,0,0,.25)"},attrs:{slot:"prefix",type:"link"},slot:"prefix"})],1)],1),r("a-form-model-item",{attrs:{prop:"title"}},[r("a-input",{attrs:{placeholder:"博客标题"},model:{value:e.form.model.title,callback:function(t){e.$set(e.form.model,"title",t)},expression:"form.model.title"}},[r("a-icon",{staticStyle:{color:"rgba(0,0,0,.25)"},attrs:{slot:"prefix",type:"book"},slot:"prefix"})],1)],1)],1),r("div",{directives:[{name:"show",rawName:"v-show",value:e.isImportMode,expression:"isImportMode"}],staticClass:"animated fadeIn"},[r("FilePondUpload",{ref:"upload",attrs:{name:"file",accepts:["application/json"],label:"拖拽或点击选择数据文件<br>请确认是否为 Halo 后台导出的文件。",multiple:!1,uploadHandler:e.onImportUpload}})],1),r("div",{staticClass:"mt-8"},[e.isInstallMode?r("ReactiveButton",{attrs:{icon:"check",type:"primary",block:"",size:"large",loading:e.form.installing,errored:e.form.installErrored,text:"安装",loadedText:"安装成功",erroredText:"安装失败"},on:{click:e.handleInstall,callback:e.handleInstallCallback}}):e._e(),e.isImportMode?r("ReactiveButton",{attrs:{icon:"import",type:"primary",block:"",size:"large",loading:e.form.importing,errored:e.form.importErrored,text:"导入",loadedText:"导入成功",erroredText:"导入失败"},on:{click:e.handleImport,callback:e.handleImportCallback}}):e._e()],1)],1)],1)])],1)],1)},o=[],i=(r("7ad2"),r("7c02"),r("0277"),r("833b"),r("b26c")),n=r("00aa"),s=r("50fc"),l=r("9efd"),m="/api/admin/migrations",c={migrate:function(e){return Object(l["a"])({url:"".concat(m,"/halo"),data:e,method:"post"})}},d=c,p=r("6c71");function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){Object(n["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var g={data:function(){var e=this,t=function(t,r,a){r!==e.form.model.password?a(new Error("确认密码与所输入的密码不一致")):a()};return{installationMode:"new",form:{model:{},rules:{username:[{required:!0,message:"* 用户名不能为空",trigger:["change"]},{max:50,message:"* 用户名的字符长度不能超过 50",trigger:["change"]}],nickname:[{required:!0,message:"* 用户昵称不能为空",trigger:["change"]},{max:255,message:"* 用户昵称的字符长度不能超过 255",trigger:["change"]}],email:[{required:!0,message:"* 电子邮件地址不能为空",trigger:["change"]},{max:127,message:"* 电子邮件地址的字符长度不能超过 127",trigger:["change"]},{pattern:/\w[-\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\.)+[A-Za-z]{2,14}/g,message:"* 电子邮件地址的格式不正确",trigger:["change"]}],password:[{required:!0,message:"* 密码不能为空",trigger:["change"]},{min:8,max:100,message:"* 密码的字符长度必须在 8 - 100 之间",trigger:["change"]}],confirmPassword:[{required:!0,message:"* 确认密码不能为空",trigger:["change"]},{validator:t,trigger:["change"]}],url:[{required:!0,message:"* 博客地址不能为空",trigger:["change"]}],title:[{required:!0,message:"* 博客标题不能为空",trigger:["change"]}]},installing:!1,installErrored:!1,importing:!1,importErrored:!1,importData:null}}},beforeMount:function(){this.handleVerifyIsInstall(),this.$set(this.form.model,"url",window.location.protocol+"//"+window.location.host)},computed:{isInstallMode:function(){return"new"===this.installationMode},isImportMode:function(){return"import"===this.installationMode}},methods:u(u({},Object(p["b"])(["installCleanToken"])),{},{handleVerifyIsInstall:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,s["a"].isInstalled();case 2:if(t=e.sent,!t.data.data){e.next=6;break}return e.next=6,this.$router.push({name:"Login"});case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),handleInstall:function(){var e=this;this.$refs.installationForm.validate((function(t){t&&(e.form.installing=!0,e.installCleanToken(e.form.model).then((function(t){e.$log.debug("Installation response",t)})).catch((function(){e.form.installErrored=!0})).finally((function(){setTimeout((function(){e.form.installing=!1}),400)})))}))},handleInstallCallback:function(){this.form.installErrored?this.form.installErrored=!1:(this.$message.success("安装成功！"),this.$router.push({name:"Login"}))},onImportUpload:function(e){var t=this;return this.$log.debug("Selected data",e),this.form.importData=e,new Promise((function(e){t.$log.debug("Handle uploading"),e()}))},handleImport:function(){var e=this;this.form.importData?(this.form.importing=!0,d.migrate(this.form.importData).then((function(){e.$log.debug("Migrated successfully")})).catch((function(){e.form.importErrored=!0})).finally((function(){setTimeout((function(){e.form.importing=!1}),400)}))):this.$message.warning("请先上传数据文件！")},handleImportCallback:function(){this.form.importErrored?this.form.importErrored=!1:(this.$message.success("导入成功！"),this.$router.push({name:"Login"}))}})},h=g,b=(r("7d6c"),r("bdd7")),w=Object(b["a"])(h,a,o,!1,null,"16d2325c",null);t["default"]=w.exports},"7a62":function(e,t,r){},"7d6c":function(e,t,r){"use strict";r("7a62")}}]);