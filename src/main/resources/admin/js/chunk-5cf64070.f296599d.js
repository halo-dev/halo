(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5cf64070"],{"1cac":function(t,e,a){"use strict";var r=a("3714"),o=a.n(r);o.a},3714:function(t,e,a){},"5d6b":function(t,e,a){var r=a("e53d").parseInt,o=a("a1ce").trim,s=a("e692"),n=/^[-+]?0[xX]/;t.exports=8!==r(s+"08")||22!==r(s+"0x16")?function(t,e){var a=o(String(t),3);return r(a,e>>>0||(n.test(a)?16:10))}:r},7445:function(t,e,a){var r=a("63b6"),o=a("5d6b");r(r.G+r.F*(parseInt!=o),{parseInt:o})},b9e9:function(t,e,a){a("7445"),t.exports=a("584a").parseInt},c405:function(t,e,a){"use strict";a("7f7f"),a("ac6a");var r=a("9efd"),o="/api/admin/categories",s={};function n(t,e){e.forEach(function(e){t.key===e.parentId&&(t.children||(t.children=[]),t.children.push({key:e.id,title:e.name,isLeaf:!1}))}),t.children?t.children.forEach(function(t){return n(t,e)}):t.isLeaf=!0}s.listAll=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Object(r["a"])({url:"".concat(o),params:{more:t},method:"get"})},s.listTree=function(){return Object(r["a"])({url:"".concat(o,"/tree_view"),method:"get"})},s.create=function(t){return Object(r["a"])({url:o,data:t,method:"post"})},s.delete=function(t){return Object(r["a"])({url:"".concat(o,"/").concat(t),method:"delete"})},s.get=function(t){return Object(r["a"])({url:"".concat(o,"/").concat(t),method:"get"})},s.update=function(t,e){return Object(r["a"])({url:"".concat(o,"/").concat(t),data:e,method:"put"})},s.concreteTree=function(t){var e={key:0,title:"top",children:[]};return n(e,t),e.children},e["a"]=s},caf6:function(t,e,a){"use strict";var r=a("9efd"),o="/api/admin/posts",s={listLatest:function(t){return Object(r["a"])({url:"".concat(o,"/latest"),params:{top:t},method:"get"})},query:function(t){return Object(r["a"])({url:o,params:t,method:"get"})},get:function(t){return Object(r["a"])({url:"".concat(o,"/").concat(t),method:"get"})},create:function(t){return Object(r["a"])({url:o,method:"post",data:t})},update:function(t,e){return Object(r["a"])({url:"".concat(o,"/").concat(t),method:"put",data:e})},updateStatus:function(t,e){return Object(r["a"])({url:"".concat(o,"/").concat(t,"/status/").concat(e),method:"put"})},delete:function(t){return Object(r["a"])({url:"".concat(o,"/").concat(t),method:"delete"})},postStatus:{PUBLISHED:{color:"green",status:"success",text:"已发布"},DRAFT:{color:"yellow",status:"warning",text:"草稿"},RECYCLE:{color:"red",status:"error",text:"回收站"}}};e["a"]=s},d28d:function(t,e,a){"use strict";var r=a("9efd"),o="/api/admin/tags",s={listAll:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Object(r["a"])({url:o,params:{more:t},method:"get"})},createWithName:function(t){return Object(r["a"])({url:o,data:{name:t},method:"post"})},create:function(t){return Object(r["a"])({url:o,data:t,method:"post"})},update:function(t,e){return Object(r["a"])({url:"".concat(o,"/").concat(t),data:e,method:"put"})},delete:function(t){return Object(r["a"])({url:"".concat(o,"/").concat(t),method:"delete"})}};e["a"]=s},db44:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"page-header-index-wide"},[a("a-row",{attrs:{gutter:12}},[a("a-col",{attrs:{span:24}},[a("div",{staticStyle:{"margin-bottom":"16px"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["title",{rules:[{required:!0,message:"请输入文章标题"}]}],expression:"['title', { rules: [{ required: true, message: '请输入文章标题' }] }]"}],attrs:{size:"large",placeholder:"请输入文章标题"},model:{value:t.postToStage.title,callback:function(e){t.$set(t.postToStage,"title",e)},expression:"postToStage.title"}})],1),a("div",{attrs:{id:"editor"}},[a("mavon-editor",{attrs:{boxShadow:!1,toolbars:t.toolbars,ishljs:!0,autofocus:!1},model:{value:t.postToStage.originalContent,callback:function(e){t.$set(t.postToStage,"originalContent",e)},expression:"postToStage.originalContent"}})],1)])],1),a("a-drawer",{attrs:{title:"文章设置",width:t.isMobile()?"100%":"460",placement:"right",closable:"",visible:t.visible},on:{close:t.onClose}},[a("div",{staticClass:"post-setting-drawer-content"},[a("div",{style:{marginBottom:"16px"}},[a("h3",{staticClass:"post-setting-drawer-title"},[t._v("基本设置")]),a("div",{staticClass:"post-setting-drawer-item"},[a("a-form",{attrs:{layout:"vertical"}},[a("a-form-item",{attrs:{label:"文章路径：",help:"/archives/"+(t.postToStage.url?t.postToStage.url:"{auto_generate}")}},[a("a-input",{model:{value:t.postToStage.url,callback:function(e){t.$set(t.postToStage,"url",e)},expression:"postToStage.url"}})],1),a("a-form-item",{attrs:{label:"开启评论："}},[a("a-radio-group",{attrs:{defaultValue:!1},model:{value:t.postToStage.disallowComment,callback:function(e){t.$set(t.postToStage,"disallowComment",e)},expression:"postToStage.disallowComment"}},[a("a-radio",{attrs:{value:!1}},[t._v("开启")]),a("a-radio",{attrs:{value:!0}},[t._v("关闭")])],1)],1)],1)],1)]),a("a-divider"),a("div",{style:{marginBottom:"16px"}},[a("h3",{staticClass:"post-setting-drawer-title"},[t._v("分类目录")]),a("div",{staticClass:"post-setting-drawer-item"},[a("category-tree",{attrs:{categories:t.categories},model:{value:t.selectedCategoryIds,callback:function(e){t.selectedCategoryIds=e},expression:"selectedCategoryIds"}}),a("div",[a("a-form",{attrs:{layout:"vertical"}},[t.categoryForm?a("a-form-item",[a("category-select-tree",{attrs:{categories:t.categories},model:{value:t.categoryToCreate.parentId,callback:function(e){t.$set(t.categoryToCreate,"parentId",e)},expression:"categoryToCreate.parentId"}})],1):t._e(),t.categoryForm?a("a-form-item",[a("a-input",{attrs:{placeholder:"分类名称"},model:{value:t.categoryToCreate.name,callback:function(e){t.$set(t.categoryToCreate,"name",e)},expression:"categoryToCreate.name"}})],1):t._e(),t.categoryForm?a("a-form-item",[a("a-input",{attrs:{placeholder:"分类路径"},model:{value:t.categoryToCreate.slugNames,callback:function(e){t.$set(t.categoryToCreate,"slugNames",e)},expression:"categoryToCreate.slugNames"}})],1):t._e(),a("a-form-item",[t.categoryForm?a("a-button",{staticStyle:{marginRight:"8px"},attrs:{type:"primary"},on:{click:t.handlerCreateCategory}},[t._v("保存")]):t._e(),t.categoryForm?t._e():a("a-button",{staticStyle:{marginRight:"8px"},attrs:{type:"dashed"},on:{click:t.toggleCategoryForm}},[t._v("新增")]),t.categoryForm?a("a-button",{on:{click:t.toggleCategoryForm}},[t._v("取消")]):t._e()],1)],1)],1)],1)]),a("a-divider"),a("div",{style:{marginBottom:"16px"}},[a("h3",{staticClass:"post-setting-drawer-title"},[t._v("标签")]),a("div",{staticClass:"post-setting-drawer-item"},[a("a-form",{attrs:{layout:"vertical"}},[a("a-form-item",[a("TagSelect",{model:{value:t.selectedTagIds,callback:function(e){t.selectedTagIds=e},expression:"selectedTagIds"}})],1)],1)],1)]),a("a-divider"),a("div",{style:{marginBottom:"16px"}},[a("h3",{staticClass:"post-setting-drawer-title"},[t._v("摘要")]),a("div",{staticClass:"post-setting-drawer-item"},[a("a-form",{attrs:{layout:"vertical"}},[a("a-form-item",[a("a-input",{attrs:{type:"textarea",autosize:{minRows:5},placeholder:"不填写则会自动生成"},model:{value:t.postToStage.summary,callback:function(e){t.$set(t.postToStage,"summary",e)},expression:"postToStage.summary"}})],1)],1)],1)]),a("a-divider"),a("div",{style:{marginBottom:"16px"}},[a("h3",{staticClass:"post-setting-drawer-title"},[t._v("缩略图")]),a("div",{staticClass:"post-setting-drawer-item"},[a("div",{staticClass:"post-thum"},[a("img",{staticClass:"img",attrs:{src:t.postToStage.thumbnail||"//i.loli.net/2019/05/05/5ccf007c0a01d.png"},on:{click:t.handleShowThumbDrawer}}),a("a-button",{staticClass:"post-thum-remove",attrs:{type:"dashed"},on:{click:t.handlerRemoveThumb}},[t._v("移除")])],1)])]),a("a-divider",{staticClass:"divider-transparent"})],1),a("AttachmentSelectDrawer",{attrs:{drawerWidth:460},on:{listenToSelect:t.handleSelectPostThumb},model:{value:t.thumDrawerVisible,callback:function(e){t.thumDrawerVisible=e},expression:"thumDrawerVisible"}}),a("div",{staticClass:"bottom-control"},[a("a-button",{staticStyle:{marginRight:"8px"},on:{click:t.handleDraftClick}},[t._v("保存草稿")]),a("a-button",{attrs:{type:"primary"},on:{click:t.handlePublishClick}},[t._v("发布")])],1)],1),a("AttachmentDrawer",{model:{value:t.attachmentDrawerVisible,callback:function(e){t.attachmentDrawerVisible=e},expression:"attachmentDrawerVisible"}}),a("footer-tool-bar",{style:{width:t.isSideMenu()&&t.isDesktop()?"calc(100% - "+(t.sidebarOpened?256:80)+"px)":"100%"}},[a("a-button",{attrs:{type:"primary"},on:{click:t.handleShowDrawer}},[t._v("发布")]),a("a-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"dashed"},on:{click:t.handleShowAttachDrawer}},[t._v("附件库")])],1)],1)},o=[],s=a("eda3"),n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("a-select",{staticStyle:{width:"100%"},attrs:{allowClear:"",mode:"tags",placeholder:"选择或输入标签"},on:{blur:t.handleBlur},model:{value:t.selectedTagNames,callback:function(e){t.selectedTagNames=e},expression:"selectedTagNames"}},t._l(t.tags,function(e){return a("a-select-option",{key:e.id,attrs:{value:e.name}},[t._v(t._s(e.name))])}),1)],1)},i=[],c=(a("ac6a"),a("7f7f"),a("d28d")),l=a("bc3a"),u=a.n(l),d={name:"TagSelect",model:{prop:"tagIds",event:"change"},props:{tagIds:{type:Array,required:!1,default:function(){return[]}}},data:function(){return{tags:[],selectedTagNames:[]}},created:function(){var t=this;this.loadTags(),this.selectedTagNames=this.tagIds.map(function(e){return t.tagIdMap[e].name})},computed:{tagIdMap:function(){var t={};return this.tags.forEach(function(e){t[e.id]=e}),t},tagNameMap:function(){var t={};return this.tags.forEach(function(e){t[e.name]=e}),t}},methods:{loadTags:function(t){var e=this;c["a"].listAll(!0).then(function(a){e.tags=a.data.data,t&&t()})},handleBlur:function(){var t=this;this.$log.debug("Blured");var e=this.selectedTagNames.filter(function(e){return!t.tagNameMap[e]});if(this.$log.debug("Tag names to create",e),e!==[]){var a=e.map(function(t){return c["a"].createWithName(t)});u.a.all(a).then(u.a.spread(function(){t.loadTags(function(){t.$log.debug("Tag name map",t.tagNameMap);var e=t.selectedTagNames.map(function(e){return t.tagNameMap[e].id});t.$emit("change",e)})}))}else{var r=this.selectedTagNames.map(function(e){return t.tagNameMap[e].id});this.$emit("change",r)}}}},g=d,m=a("2877"),h=Object(m["a"])(g,n,i,!1,null,null,null),p=h.exports,f=a("b2d8"),v=a("ed4e"),b=a("3993"),y=a("fa25"),T=a("5a70"),S=a("ac0d"),C=a("2749"),w=(a("64e1"),a("c405")),x=a("caf6"),I={components:{TagSelect:p,mavonEditor:f["mavonEditor"],CategoryTree:s["a"],FooterToolBar:T["a"],AttachmentDrawer:v["a"],AttachmentSelectDrawer:b["a"],CategorySelectTree:y["a"]},mixins:[S["a"],S["b"]],data:function(){return{toolbars:C["a"],wrapperCol:{xl:{span:24},sm:{span:24},xs:{span:24}},attachmentDrawerVisible:!1,visible:!1,thumDrawerVisible:!1,categoryForm:!1,tags:[],categories:[],selectedCategoryIds:[],selectedTagIds:[],postToStage:{},categoryToCreate:{},timer:null}},created:function(){this.loadTags(),this.loadCategories(),clearInterval(this.timer),this.timer=null,this.autoSaveTimer()},destroyed:function(){clearInterval(this.timer),this.timer=null},beforeRouteEnter:function(t,e,a){var r=t.query.postId;a(function(t){r&&x["a"].get(r).then(function(e){var a=e.data.data;t.postToStage=a,t.selectedTagIds=a.tagIds,t.selectedCategoryIds=a.categoryIds})})},methods:{loadTags:function(){var t=this;c["a"].listAll(!0).then(function(e){t.tags=e.data.data})},loadCategories:function(){var t=this;w["a"].listAll().then(function(e){t.categories=e.data.data})},createOrUpdatePost:function(t,e){var a=this;this.postToStage.categoryIds=this.selectedCategoryIds,this.postToStage.tagIds=this.selectedTagIds,this.postToStage.id?x["a"].update(this.postToStage.id,this.postToStage).then(function(t){a.$log.debug("Updated post",t.data.data),e&&e()}):x["a"].create(this.postToStage).then(function(e){a.$log.debug("Created post",e.data.data),t&&t(),a.postToStage=e.data.data})},savePost:function(){var t=this;this.createOrUpdatePost(function(){return t.$message.success("文章创建成功")},function(){return t.$message.success("文章更新成功")})},autoSavePost:function(){this.createOrUpdatePost()},handleShowDrawer:function(){this.visible=!0},handleShowAttachDrawer:function(){this.attachmentDrawerVisible=!0},handleShowThumbDrawer:function(){this.thumDrawerVisible=!0},toggleCategoryForm:function(){this.categoryForm=!this.categoryForm},handlePublishClick:function(){this.postToStage.status="PUBLISHED",this.createOrUpdatePost()},handleDraftClick:function(){this.postToStage.status="DRAFT",this.createOrUpdatePost()},handlerRemoveThumb:function(){this.postToStage.thumbnail=null},handlerCreateCategory:function(){var t=this;w["a"].create(this.categoryToCreate).then(function(e){t.loadCategories(),t.categoryToCreate={}})},onClose:function(){this.visible=!1},handleSelectPostThumb:function(t){this.postToStage.thumbnail=t.path,this.thumDrawerVisible=!1},autoSaveTimer:function(){var t=this;null==this.timer&&(this.timer=setInterval(function(){t.autoSavePost()},15e3))}},beforeRouteLeave:function(t,e,a){null!==this.timer&&clearInterval(this.timer),this.autoSavePost(),a()}},k=I,_=(a("1cac"),Object(m["a"])(k,r,o,!1,null,"e9899606",null));e["default"]=_.exports},e814:function(t,e,a){t.exports=a("b9e9")},eda3:function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-tree",{attrs:{checkable:"",treeData:t.categoryTree,defaultExpandAll:!0,checkedKeys:t.categoryIds},on:{check:t.onCheck}},[a("span",{staticStyle:{color:"#1890ff"},attrs:{slot:"title0010"},slot:"title0010"},[t._v("sss")])])},o=[],s=a("c405"),n={name:"CategoryTree",model:{prop:"categoryIds",event:"check"},props:{categoryIds:{type:Array,required:!1,default:function(){return[]}},categories:{type:Array,required:!1,default:function(){return[]}}},computed:{categoryTree:function(){return s["a"].concreteTree(this.categories)}},methods:{onCheck:function(t,e){this.$log.debug("Chekced keys",t),this.$log.debug("e",e);var a=e.checkedNodes.filter(function(t){return t.data.props.isLeaf}).map(function(t){return t.key});this.$log.debug("Effectively selected category ids",a),this.$emit("check",a)}}},i=n,c=a("2877"),l=Object(c["a"])(i,r,o,!1,null,null,null);e["a"]=l.exports},fa25:function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-tree-select",{attrs:{treeData:t.categoryTreeData,placeholder:"请选择上级目录，默认为顶级目录",treeDefaultExpandAll:"",treeDataSimpleMode:!0,allowClear:!0,value:t.categoryIdString},on:{change:t.handleSelectionChange}})},o=[],s=a("e814"),n=a.n(s),i=(a("6b54"),a("7f7f"),a("c5f6"),{name:"CategorySelectTree",model:{prop:"categoryId",event:"change"},props:{categoryId:{type:Number,required:!0,default:0},categories:{type:Array,required:!1,default:function(){return[]}}},computed:{categoryTreeData:function(){return this.categories.map(function(t){return{id:t.id,title:t.name,value:t.id.toString(),pId:t.parentId}})},categoryIdString:function(){return this.categoryId.toString()}},methods:{handleSelectionChange:function(t,e,a){this.$log.debug("value: ",t),this.$log.debug("label: ",e),this.$log.debug("extra: ",a),this.$emit("change",t?n()(t):0)}}}),c=i,l=a("2877"),u=Object(l["a"])(c,r,o,!1,null,null,null);e["a"]=u.exports}}]);