(self["webpackChunkhalo_admin"]=self["webpackChunkhalo_admin"]||[]).push([[970],{53303:function(t,e,a){var n=a(15820),o=Math.floor,i=function(t,e){var a=t.length,l=o(a/2);return a<8?r(t,e):s(t,i(n(t,0,l),e),i(n(t,l),e),e)},r=function(t,e){var a,n,o=t.length,i=1;while(i<o){n=i,a=t[i];while(n&&e(t[n-1],a)>0)t[n]=t[--n];n!==i++&&(t[n]=a)}return t},s=function(t,e,a,n){var o=e.length,i=a.length,r=0,s=0;while(r<o||s<i)t[r+s]=r<o&&s<i?n(e[r],a[s])<=0?e[r++]:a[s++]:r<o?e[r++]:a[s++];return t};t.exports=i},52103:function(t,e,a){var n=a(82678),o=n.match(/firefox\/(\d+)/i);t.exports=!!o&&+o[1]},76044:function(t,e,a){var n=a(82678);t.exports=/MSIE|Trident/.test(n)},97551:function(t,e,a){var n=a(82678),o=n.match(/AppleWebKit\/(\d+)\./);t.exports=!!o&&+o[1]},19003:function(t,e,a){"use strict";var n=a(79644),o=a(33691),i=a(77925),r=a(43207),s=a(71768),l=a(43150),u=a(32640),c=a(53303),d=a(29415),p=a(52103),f=a(76044),m=a(3718),h=a(97551),v=[],y=o(v.sort),g=o(v.push),k=u((function(){v.sort(void 0)})),b=u((function(){v.sort(null)})),C=d("sort"),x=!u((function(){if(m)return m<70;if(!(p&&p>3)){if(f)return!0;if(h)return h<603;var t,e,a,n,o="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:a=3;break;case 68:case 71:a=4;break;default:a=2}for(n=0;n<47;n++)v.push({k:e+n,v:a})}for(v.sort((function(t,e){return e.v-t.v})),n=0;n<v.length;n++)e=v[n].k.charAt(0),o.charAt(o.length-1)!==e&&(o+=e);return"DGBEFHACIJK"!==o}})),T=k||!b||!C||!x,w=function(t){return function(e,a){return void 0===a?-1:void 0===e?1:void 0!==t?+t(e,a)||0:l(e)>l(a)?1:-1}};n({target:"Array",proto:!0,forced:T},{sort:function(t){void 0!==t&&i(t);var e=r(this);if(x)return void 0===t?y(e):y(e,t);var a,n,o=[],l=s(e);for(n=0;n<l;n++)n in e&&g(o,e[n]);c(o,w(t)),a=o.length,n=0;while(n<a)e[n]=o[n++];while(n<l)delete e[n++];return e}})},90970:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return f}});var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"option-tab-wrapper"},[a("a-card",{attrs:{bodyStyle:{padding:0},bordered:!1}},[a("div",{staticClass:"table-page-search-wrapper"},[a("a-form",{attrs:{layout:"inline"}},[a("a-row",{attrs:{gutter:48}},[a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{attrs:{label:"关键词："}},[a("a-input",{on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleQuery()}},model:{value:t.queryParam.keyword,callback:function(e){t.$set(t.queryParam,"keyword",e)},expression:"queryParam.keyword"}})],1)],1),a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{attrs:{label:"类型："}},[a("a-select",{attrs:{allowClear:"",placeholder:"请选择类型"},on:{change:function(e){return t.handleQuery()}},model:{value:t.queryParam.type,callback:function(e){t.$set(t.queryParam,"type",e)},expression:"queryParam.type"}},t._l(Object.keys(t.optionType),(function(e){return a("a-select-option",{key:e,attrs:{value:e}},[t._v(t._s(t.optionType[e].text)+" ")])})),1)],1)],1),a("a-col",{attrs:{md:12,sm:24}},[a("span",{staticClass:"table-page-search-submitButtons"},[a("a-space",[a("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.handleQuery()}}},[t._v("查询")]),a("a-button",{on:{click:function(e){return t.handleResetParam()}}},[t._v("重置")])],1)],1)])],1)],1)],1),a("div",{staticClass:"table-operator"},[a("a-button",{attrs:{icon:"plus",type:"primary"},on:{click:t.handleOpenFormModal}},[t._v("新增")])],1),a("div",{staticClass:"mt-4"},[a("a-table",{attrs:{columns:t.columns,dataSource:t.formattedData,loading:t.loading,pagination:!1,rowKey:function(t){return t.id},scrollToFirstRowOnChange:!0},scopedSlots:t._u([{key:"type",fn:function(e){return a("span",{},[t._v(" "+t._s(e.text)+" ")])}},{key:"createTime",fn:function(e){return a("span",{},[a("a-tooltip",{attrs:{placement:"top"}},[a("template",{slot:"title"},[t._v(" "+t._s(t._f("moment")(e))+" ")]),t._v(" "+t._s(t._f("timeAgo")(e))+" ")],2)],1)}},{key:"updateTime",fn:function(e){return a("span",{},[a("a-tooltip",{attrs:{placement:"top"}},[a("template",{slot:"title"},[t._v(" "+t._s(t._f("moment")(e))+" ")]),t._v(" "+t._s(t._f("timeAgo")(e))+" ")],2)],1)}},{key:"action",fn:function(e,n){return a("span",{},[a("a-button",{staticClass:"!p-0",attrs:{type:"link"},on:{click:function(e){return t.handleOpenEditFormModal(n)}}},[t._v("编辑")]),a("a-divider",{attrs:{type:"vertical"}}),a("a-popconfirm",{attrs:{title:"你确定要永久删除该变量？",cancelText:"取消",okText:"确定"},on:{confirm:function(e){return t.handleDeleteOption(n.id)}}},[a("a-button",{staticClass:"!p-0",attrs:{type:"link"}},[t._v("删除")])],1)],1)}}])}),a("div",{staticClass:"page-wrapper"},[a("a-pagination",{staticClass:"pagination",attrs:{current:t.pagination.page,defaultPageSize:t.pagination.size,pageSizeOptions:["10","20","50","100"],total:t.pagination.total,showLessItems:"",showSizeChanger:""},on:{change:t.handlePaginationChange,showSizeChange:t.handlePaginationChange}})],1)],1)]),a("a-modal",{attrs:{afterClose:t.onFormClose,title:t.formTitle},model:{value:t.form.visible,callback:function(e){t.$set(t.form,"visible",e)},expression:"form.visible"}},[a("template",{slot:"footer"},[a("ReactiveButton",{attrs:{errored:t.form.saveErrored,loading:t.form.saving,erroredText:"保存失败",loadedText:"保存成功",text:"保存"},on:{callback:t.handleSaveOrUpdateCallback,click:t.handleSaveOrUpdate}})],1),t.form.model.type===t.optionType.INTERNAL.value?a("a-alert",{attrs:{banner:"",closable:"",message:"注意：在不知道系统变量的具体用途时，请不要随意修改！"}}):t._e(),a("a-form-model",{ref:"optionForm",attrs:{model:t.form.model,rules:t.form.rules,layout:"vertical"}},[a("a-form-model-item",{attrs:{label:"Key：",prop:"key"}},[a("a-input",{ref:"keyInput",model:{value:t.form.model.key,callback:function(e){t.$set(t.form.model,"key",e)},expression:"form.model.key"}})],1),a("a-form-model-item",{attrs:{label:"Value：",prop:"value"}},[a("a-input",{attrs:{autoSize:{minRows:5},type:"textarea"},model:{value:t.form.model.value,callback:function(e){t.$set(t.form.model,"value",e)},expression:"form.model.value"}})],1)],1)],2)],1)},o=[],i=a(92164),r=(a(82395),a(19003),a(31875),a(41479),a(18608)),s=a(98906),l=[{title:"Key",dataIndex:"key",ellipsis:!0,scopedSlots:{customRender:"key"}},{title:"Value",dataIndex:"value",ellipsis:!0,scopedSlots:{customRender:"value"}},{title:"类型",dataIndex:"typeProperty",width:"100px",scopedSlots:{customRender:"type"}},{title:"创建时间",dataIndex:"createTime",width:"200px",scopedSlots:{customRender:"createTime"}},{title:"更新时间",dataIndex:"updateTime",width:"200px",scopedSlots:{customRender:"updateTime"}},{title:"操作",dataIndex:"action",width:"120px",scopedSlots:{customRender:"action"}}],u={name:"OptionsList",data:function(){return{optionType:{INTERNAL:{value:"INTERNAL",text:"系统"},CUSTOM:{value:"CUSTOM",text:"自定义"}},columns:l,pagination:{page:1,size:10,sort:null,total:1},queryParam:{page:0,size:10,sort:null,keyword:null,type:null},loading:!1,options:[],form:{visible:!1,model:{},rules:{key:[{required:!0,message:"* Key 不能为空",trigger:["change"]}],value:[{required:!0,message:"* Value 不能为空",trigger:["change"]}]},saving:!1,saveErrored:!1}}},computed:{formattedData:function(){var t=this;return this.options.map((function(e){return e.typeProperty=t.optionType[e.type],e}))},formTitle:function(){return this.form.model.id?"编辑":"新增"}},beforeMount:function(){this.handleListOptions()},methods:(0,i.Z)((0,i.Z)({},(0,s.nv)(["refreshOptionsCache"])),{},{handleListOptions:function(){var t=this;this.loading=!0,this.queryParam.page=this.pagination.page-1,this.queryParam.size=this.pagination.size,this.queryParam.sort=this.pagination.sort,r.Z.option.listAsView(this.queryParam).then((function(e){if(0===e.data.content.length&&t.pagination.page>0)return t.pagination.page--,void t.handleListOptions();t.options=e.data.content,t.pagination.total=e.data.total})).finally((function(){t.loading=!1}))},handleQuery:function(){this.handlePaginationChange(1,this.pagination.size)},handleDeleteOption:function(t){var e=this;r.Z.option["delete"](t).then((function(){e.$message.success("删除成功！")})).finally((function(){e.handleListOptions(),e.refreshOptionsCache()}))},handleOpenFormModal:function(){var t=this;this.form.visible=!0,this.$nextTick((function(){t.$refs.keyInput.focus()}))},handleOpenEditFormModal:function(t){var e=this;this.form.model=t,this.form.visible=!0,this.$nextTick((function(){e.$refs.keyInput.focus()}))},handlePaginationChange:function(t,e){this.$log.debug("Current: ".concat(t,", PageSize: ").concat(e)),this.pagination.page=t,this.pagination.size=e,this.handleListOptions()},handleResetParam:function(){this.queryParam.keyword=null,this.queryParam.type=null,this.handlePaginationChange(1,this.pagination.size)},onFormClose:function(){this.form.visible=!1,this.form.model={}},handleSaveOrUpdate:function(){var t=this;t.$refs.optionForm.validate((function(e){e&&(t.form.saving=!0,t.form.model.id?r.Z.option.update(t.form.model.id,t.form.model).catch((function(){t.form.saveErrored=!0})).finally((function(){setTimeout((function(){t.form.saving=!1}),400)})):(t.form.model.type=t.optionType.CUSTOM.value,r.Z.option.create(t.form.model).catch((function(){t.form.saveErrored=!0})).finally((function(){setTimeout((function(){t.form.saving=!1}),400)}))))}))},handleSaveOrUpdateCallback:function(){this.form.saveErrored?this.form.saveErrored=!1:(this.form.model={},this.form.visible=!1,this.handleListOptions(),this.refreshOptionsCache())}})},c=u,d=a(42177),p=(0,d.Z)(c,n,o,!1,null,null,null),f=p.exports}}]);