(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5000e55c"],{"3e5b":function(t,a,e){},"5bcf":function(t,a,e){"use strict";var n=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("a-drawer",{attrs:{title:"附件详情",width:t.isMobile()?"100%":"460",closable:"",visible:t.visiable,destroyOnClose:""},on:{close:t.onClose}},[e("a-row",{attrs:{type:"flex",align:"middle"}},[e("a-col",{attrs:{span:24}},[e("a-skeleton",{attrs:{active:"",loading:t.detailLoading,paragraph:{rows:8}}},[e("div",{staticClass:"attach-detail-img"},[e("img",{attrs:{src:t.attachment.path}})])])],1),e("a-divider"),e("a-col",{attrs:{span:24}},[e("a-skeleton",{attrs:{active:"",loading:t.detailLoading,paragraph:{rows:8}}},[e("a-list",{attrs:{itemLayout:"horizontal"}},[e("a-list-item",[e("a-list-item-meta",[t.editable?e("template",{slot:"description"},[e("a-input",{on:{blur:t.doUpdateAttachment},model:{value:t.attachment.name,callback:function(a){t.$set(t.attachment,"name",a)},expression:"attachment.name"}})],1):e("template",{slot:"description"},[t._v(t._s(t.attachment.name))]),e("span",{attrs:{slot:"title"},slot:"title"},[t._v("\n                附件名：\n                "),e("a",{attrs:{href:"javascript:void(0);"}},[e("a-icon",{attrs:{type:"edit"},on:{click:t.handleEditName}})],1)])],2)],1),e("a-list-item",[e("a-list-item-meta",{attrs:{description:t.attachment.mediaType}},[e("span",{attrs:{slot:"title"},slot:"title"},[t._v("附件类型：")])])],1),e("a-list-item",[e("a-list-item-meta",{attrs:{description:t.attachment.typeProperty}},[e("span",{attrs:{slot:"title"},slot:"title"},[t._v("存储位置：")])])],1),e("a-list-item",[e("a-list-item-meta",[e("template",{slot:"description"},[t._v("\n                "+t._s(t._f("fileSizeFormat")(t.attachment.size))+"\n              ")]),e("span",{attrs:{slot:"title"},slot:"title"},[t._v("附件大小：")])],2)],1),e("a-list-item",[e("a-list-item-meta",{attrs:{description:t.attachment.height+"x"+t.attachment.width}},[e("span",{attrs:{slot:"title"},slot:"title"},[t._v("图片尺寸：")])])],1),e("a-list-item",[e("a-list-item-meta",[e("template",{slot:"description"},[t._v("\n                "+t._s(t._f("moment")(t.attachment.createTime))+"\n              ")]),e("span",{attrs:{slot:"title"},slot:"title"},[t._v("上传日期：")])],2)],1),e("a-list-item",[e("a-list-item-meta",{attrs:{description:t.attachment.path}},[e("span",{attrs:{slot:"title"},slot:"title"},[t._v("\n                普通链接：\n                "),e("a",{attrs:{href:"javascript:void(0);"}},[e("a-icon",{attrs:{type:"copy"},on:{click:t.handleCopyNormalLink}})],1)])])],1),e("a-list-item",[e("a-list-item-meta",[e("span",{attrs:{slot:"description"},slot:"description"},[t._v("!["+t._s(t.attachment.name)+"]("+t._s(t.attachment.path)+")")]),e("span",{attrs:{slot:"title"},slot:"title"},[t._v("\n                Markdown 格式：\n                "),e("a",{attrs:{href:"javascript:void(0);"}},[e("a-icon",{attrs:{type:"copy"},on:{click:t.handleCopyMarkdownLink}})],1)])])],1)],1)],1)],1)],1),e("a-divider",{staticClass:"divider-transparent"}),e("div",{staticClass:"bottom-control"},[t.addToPhoto?e("a-popconfirm",{attrs:{title:"你确定要添加到图库？",okText:"确定",cancelText:"取消"},on:{confirm:t.handleAddToPhoto}},[e("a-button",{staticStyle:{marginRight:"8px"},attrs:{type:"dashed"}},[t._v("添加到图库")])],1):t._e(),e("a-popconfirm",{attrs:{title:"你确定要删除该附件？",okText:"确定",cancelText:"取消"},on:{confirm:t.handleDeleteAttachment}},[e("a-button",{attrs:{type:"danger"}},[t._v("删除")])],1)],1)],1)},i=[],s=(e("7364"),e("ac0d")),o=e("a796"),l=e("975e"),r={name:"AttachmentDetailDrawer",mixins:[s["a"],s["b"]],data:function(){return{detailLoading:!0,editable:!1,photo:{}}},model:{prop:"visiable",event:"close"},props:{attachment:{type:Object,required:!0},addToPhoto:{type:Boolean,required:!1,default:!1},visiable:{type:Boolean,required:!1,default:!0}},created:function(){this.loadSkeleton()},watch:{visiable:function(t,a){this.$log.debug("old value",a),this.$log.debug("new value",t),t&&this.loadSkeleton()}},methods:{loadSkeleton:function(){var t=this;this.detailLoading=!0,setTimeout(function(){t.detailLoading=!1},500)},handleDeleteAttachment:function(){var t=this;o["a"].delete(this.attachment.id).then(function(a){t.$message.success("删除成功！"),t.$emit("delete",t.attachment),t.onClose()})},handleEditName:function(){this.editable=!this.editable},doUpdateAttachment:function(){var t=this;o["a"].update(this.attachment.id,this.attachment).then(function(a){t.$log.debug("Updated attachment",a.data.data),t.$message.success("附件修改成功！")}),this.editable=!1},handleCopyNormalLink:function(){var t=this,a="".concat(this.attachment.path);this.$copyText(a).then(function(a){console.log("copy",a),t.$message.success("复制成功！")}).catch(function(a){console.log("copy.err",a),t.$message.error("复制失败！")})},handleCopyMarkdownLink:function(){var t=this,a="![".concat(this.attachment.name,"](").concat(this.attachment.path,")");this.$copyText(a).then(function(a){console.log("copy",a),t.$message.success("复制成功！")}).catch(function(a){console.log("copy.err",a),t.$message.error("复制失败！")})},handleAddToPhoto:function(){var t=this;this.photo["name"]=this.attachment.name,this.photo["thumbnail"]=this.attachment.thumbPath,this.photo["url"]=this.attachment.path,this.photo["takeTime"]=(new Date).getTime(),l["a"].create(this.photo).then(function(a){t.$message.success("添加成功！")})},onClose:function(){this.$emit("close",!1)}}},c=r,d=(e("b3a7"),e("17cc")),u=Object(d["a"])(c,n,i,!1,null,null,null);a["a"]=u.exports},"61d0":function(t,a,e){"use strict";e.r(a);var n=function(){var t=this,a=this,e=a.$createElement,n=a._self._c||e;return n("page-view",[n("a-row",{attrs:{gutter:12,type:"flex",align:"middle"}},[n("a-col",{staticClass:"search-box",attrs:{span:24}},[n("a-card",{attrs:{bordered:!1}},[n("div",{staticClass:"table-page-search-wrapper"},[n("a-form",{attrs:{layout:"inline"}},[n("a-row",{attrs:{gutter:48}},[n("a-col",{attrs:{md:6,sm:24}},[n("a-form-item",{attrs:{label:"关键词"}},[n("a-input",{model:{value:a.queryParam.keyword,callback:function(t){a.$set(a.queryParam,"keyword",t)},expression:"queryParam.keyword"}})],1)],1),n("a-col",{attrs:{md:6,sm:24}},[n("a-form-item",{attrs:{label:"存储位置"}},[n("a-select",{on:{change:a.handleQuery},model:{value:a.queryParam.attachmentType,callback:function(t){a.$set(a.queryParam,"attachmentType",t)},expression:"queryParam.attachmentType"}},a._l(Object.keys(a.attachmentType),function(t){return n("a-select-option",{key:t,attrs:{value:t}},[a._v(a._s(a.attachmentType[t].text))])}),1)],1)],1),n("a-col",{attrs:{md:6,sm:24}},[n("a-form-item",{attrs:{label:"文件类型"}},[n("a-select",{on:{change:a.handleQuery},model:{value:a.queryParam.mediaType,callback:function(t){a.$set(a.queryParam,"mediaType",t)},expression:"queryParam.mediaType"}},a._l(a.mediaTypes,function(t,e){return n("a-select-option",{key:e,attrs:{value:t}},[a._v(a._s(t))])}),1)],1)],1),n("a-col",{attrs:{md:6,sm:24}},[n("span",{staticClass:"table-page-search-submitButtons"},[n("a-button",{attrs:{type:"primary"},on:{click:a.handleQuery}},[a._v("查询")]),n("a-button",{staticStyle:{"margin-left":"8px"},on:{click:a.handleResetParam}},[a._v("重置")])],1)])],1)],1)],1),n("div",{staticClass:"table-operator"},[n("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:function(){return t.uploadVisible=!0}}},[a._v("上传")])],1)])],1),n("a-col",{attrs:{span:24}},[n("a-list",{attrs:{grid:{gutter:12,xs:1,sm:2,md:4,lg:6,xl:6,xxl:6},dataSource:a.formattedDatas,loading:a.listLoading},scopedSlots:a._u([{key:"renderItem",fn:function(t,e){return n("a-list-item",{key:e},[n("a-card",{attrs:{bodyStyle:{padding:0},hoverable:""},on:{click:function(e){return a.handleShowDetailDrawer(t)}}},[n("div",{staticClass:"attach-thumb"},[n("img",{attrs:{src:t.thumbPath}})]),n("a-card-meta",[n("ellipsis",{attrs:{slot:"description",length:a.isMobile()?36:16,tooltip:""},slot:"description"},[a._v(a._s(t.name))])],1)],1)],1)}}])})],1)],1),n("div",{staticClass:"page-wrapper"},[n("a-pagination",{staticClass:"pagination",attrs:{total:a.pagination.total,defaultPageSize:a.pagination.size,pageSizeOptions:["18","36","54","72","90","108"],showSizeChanger:""},on:{change:a.handlePaginationChange,showSizeChange:a.handlePaginationChange}})],1),n("a-modal",{attrs:{title:"上传附件",footer:null,afterClose:a.onUploadClose},model:{value:a.uploadVisible,callback:function(t){a.uploadVisible=t},expression:"uploadVisible"}},[n("upload",{attrs:{name:"file",multiple:"",uploadHandler:a.uploadHandler}},[n("p",{staticClass:"ant-upload-drag-icon"},[n("a-icon",{attrs:{type:"inbox"}})],1),n("p",{staticClass:"ant-upload-text"},[a._v("点击选择文件或将文件拖拽到此处")]),n("p",{staticClass:"ant-upload-hint"},[a._v("支持单个或批量上传")])])],1),a.selectAttachment?n("AttachmentDetailDrawer",{attrs:{attachment:a.selectAttachment,addToPhoto:!0},on:{delete:function(){return t.loadAttachments()}},model:{value:a.drawerVisiable,callback:function(t){a.drawerVisiable=t},expression:"drawerVisiable"}}):a._e()],1)},i=[],s=(e("b745"),e("680ad")),o=e("ac0d"),l=e("5bcf"),r=e("a796"),c={components:{PageView:s["b"],AttachmentDetailDrawer:l["a"]},mixins:[o["a"],o["b"]],data:function(){return{attachmentType:r["a"].type,listLoading:!0,uploadVisible:!1,selectAttachment:{},attachments:[],mediaTypes:[],editable:!1,pagination:{page:1,size:18,sort:null},queryParam:{page:0,size:18,sort:null,keyword:null,mediaType:null,attachmentType:null},uploadHandler:r["a"].upload,drawerVisiable:!1}},computed:{formattedDatas:function(){var t=this;return this.attachments.map(function(a){return a.typeProperty=t.attachmentType[a.type],a})}},created:function(){this.loadAttachments(),this.loadMediaTypes()},methods:{loadAttachments:function(){var t=this;this.queryParam.page=this.pagination.page-1,this.queryParam.size=this.pagination.size,this.queryParam.sort=this.pagination.sort,this.listLoading=!0,r["a"].query(this.queryParam).then(function(a){t.attachments=a.data.data.content,t.pagination.total=a.data.data.total,t.listLoading=!1})},loadMediaTypes:function(){var t=this;r["a"].getMediaTypes().then(function(a){t.mediaTypes=a.data.data})},handleShowDetailDrawer:function(t){this.selectAttachment=t,this.drawerVisiable=!0},handlePaginationChange:function(t,a){this.$log.debug("Current: ".concat(t,", PageSize: ").concat(a)),this.pagination.page=t,this.pagination.size=a,this.loadAttachments()},handleResetParam:function(){this.queryParam.keyword=null,this.queryParam.mediaType=null,this.queryParam.attachmentType=null,this.loadAttachments()},handleQuery:function(){this.queryParam.page=0,this.loadAttachments()},onUploadClose:function(){this.loadAttachments(),this.loadMediaTypes()}}},d=c,u=(e("e402"),e("17cc")),m=Object(u["a"])(d,n,i,!1,null,"18d41aa9",null);a["default"]=m.exports},9298:function(t,a,e){},"975e":function(t,a,e){"use strict";var n=e("9efd"),i="/api/admin/photos",s={query:function(t){return Object(n["a"])({url:i,params:t,method:"get"})},create:function(t){return Object(n["a"])({url:i,data:t,method:"post"})},update:function(t,a){return Object(n["a"])({url:"".concat(i,"/").concat(t),method:"put",data:a})},delete:function(t){return Object(n["a"])({url:"".concat(i,"/").concat(t),method:"delete"})}};a["a"]=s},a796:function(t,a,e){"use strict";var n=e("f753"),i=e.n(n),s=e("9efd"),o="/api/admin/attachments",l={query:function(t){return Object(s["a"])({url:o,params:t,method:"get"})},get:function(t){return Object(s["a"])({url:"".concat(o,"/").concat(t),method:"get"})},delete:function(t){return Object(s["a"])({url:"".concat(o,"/").concat(t),method:"delete"})},update:function(t,a){return Object(s["a"])({url:"".concat(o,"/").concat(t),method:"put",data:a})},getMediaTypes:function(){return Object(s["a"])({url:"".concat(o,"/media_types"),method:"get"})}};l.CancelToken=i.a.CancelToken,l.isCancel=i.a.isCancel,l.upload=function(t,a,e){return Object(s["a"])({url:"".concat(o,"/upload"),timeout:864e4,data:t,onUploadProgress:a,cancelToken:e,method:"post"})},l.uploads=function(t,a,e){return Object(s["a"])({url:"".concat(o,"/uploads"),timeout:864e4,data:t,onUploadProgress:a,cancelToken:e,method:"post"})},l.type={LOCAL:{type:"local",text:"本地"},SMMS:{type:"smms",text:"SM.MS"},UPYUN:{type:"upyun",text:"又拍云"},QNYUN:{type:"qnyun",text:"七牛云"},ALIYUN:{type:"aliyun",text:"阿里云"}},a["a"]=l},b3a7:function(t,a,e){"use strict";var n=e("9298"),i=e.n(n);i.a},e402:function(t,a,e){"use strict";var n=e("3e5b"),i=e.n(n);i.a}}]);