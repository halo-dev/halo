"use strict";(self["webpackChunkhalo_admin"]=self["webpackChunkhalo_admin"]||[]).push([[176],{52176:function(t,e,a){a.r(e),a.d(e,{default:function(){return p}});var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-view",[a("a-row",{attrs:{gutter:12,align:"middle",type:"flex"}},[a("a-col",{staticClass:"pb-3",attrs:{span:24}},[a("a-card",{attrs:{bodyStyle:{padding:"16px"},bordered:!1}},[a("div",{staticClass:"table-page-search-wrapper"},[a("a-form",{attrs:{layout:"inline"}},[a("a-row",{attrs:{gutter:48}},[a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{attrs:{label:"关键词："}},[a("a-input",{on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleQuery()}},model:{value:t.list.params.keyword,callback:function(e){t.$set(t.list.params,"keyword",e)},expression:"list.params.keyword"}})],1)],1),a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{attrs:{label:"存储位置："}},[a("a-select",{attrs:{loading:t.types.loading,allowClear:""},on:{change:function(e){return t.handleQuery()}},model:{value:t.list.params.attachmentType,callback:function(e){t.$set(t.list.params,"attachmentType",e)},expression:"list.params.attachmentType"}},t._l(t.types.data,(function(e){return a("a-select-option",{key:e,attrs:{value:e}},[t._v(" "+t._s(t._f("typeText")(e))+" ")])})),1)],1)],1),a("a-col",{attrs:{md:6,sm:24}},[a("a-form-item",{attrs:{label:"文件类型："}},[a("a-select",{attrs:{loading:t.mediaTypes.loading,allowClear:""},on:{change:function(e){return t.handleQuery()}},model:{value:t.list.params.mediaType,callback:function(e){t.$set(t.list.params,"mediaType",e)},expression:"list.params.mediaType"}},t._l(t.mediaTypes.data,(function(e,s){return a("a-select-option",{key:s,attrs:{value:e}},[t._v(t._s(e)+" ")])})),1)],1)],1),a("a-col",{attrs:{md:6,sm:24}},[a("span",{staticClass:"table-page-search-submitButtons"},[a("a-space",[a("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.handleQuery()}}},[t._v("查询")]),a("a-button",{on:{click:function(e){return t.handleResetParam()}}},[t._v("重置")])],1)],1)])],1)],1)],1),a("div",{staticClass:"mb-0 table-operator"},[a("a-button",{attrs:{icon:"cloud-upload",type:"primary"},on:{click:function(e){t.upload.visible=!0}}},[t._v("上传")]),a("a-button",{directives:[{name:"show",rawName:"v-show",value:t.list.selected.length,expression:"list.selected.length"}],attrs:{icon:"check-circle",type:"primary"},on:{click:t.handleSelectAll}},[t._v(" 全选 ")]),a("a-button",{directives:[{name:"show",rawName:"v-show",value:t.list.selected.length,expression:"list.selected.length"}],attrs:{icon:"delete",type:"danger"},on:{click:t.handleDeleteAttachmentInBatch}},[t._v(" 删除 ")]),a("a-button",{directives:[{name:"show",rawName:"v-show",value:t.list.selected.length,expression:"list.selected.length"}],attrs:{icon:"close"},on:{click:function(e){t.list.selected=[]}}},[t._v(" 取消")])],1)])],1),a("a-col",{attrs:{span:24}},[a("a-list",{staticClass:"attachments-group",attrs:{dataSource:t.list.data,grid:{gutter:6,xs:2,sm:2,md:4,lg:6,xl:6,xxl:6},loading:t.list.loading},scopedSlots:t._u([{key:"renderItem",fn:function(e,s){return[a("a-list-item",{key:s,on:{mouseenter:function(a){return t.$set(e,"hover",!0)},mouseleave:function(a){return t.$set(e,"hover",!1)},click:function(a){return t.handleItemClick(e)},contextmenu:function(a){return a.preventDefault(),t.handleContextMenu(a,e)}}},[a("div",{staticClass:"border border-solid",class:t.isItemSelect(e)?"border-blue-600":"border-slate-200"},[a("div",{staticClass:"attach-thumb attachments-group-item"},[t.isImage(e)?a("span",{staticClass:"attachments-group-item-img",style:"background-image:url("+e.thumbPath+")",attrs:{loading:"lazy"}}):a("span",{staticClass:"attachments-group-item-type"},[t._v(t._s(e.suffix))])]),a("a-card-meta",{staticClass:"p-2 cursor-pointer",scopedSlots:t._u([{key:"description",fn:function(){return[a("a-tooltip",{attrs:{title:e.name}},[a("div",{staticClass:"truncate"},[t._v(t._s(e.name))])])]},proxy:!0}],null,!0)}),a("a-icon",{directives:[{name:"show",rawName:"v-show",value:!t.isItemSelect(e)&&e.hover,expression:"!isItemSelect(item) && item.hover"}],staticClass:"absolute top-1 right-2 font-bold cursor-pointer transition-all",style:{fontSize:"18px",color:"rgb(37 99 235)"},attrs:{type:"plus-circle",theme:"twoTone"},on:{click:function(a){return a.stopPropagation(),t.handleSelect(e)}}}),a("a-icon",{directives:[{name:"show",rawName:"v-show",value:t.isItemSelect(e),expression:"isItemSelect(item)"}],staticClass:"absolute top-1 right-2 font-bold cursor-pointer transition-all",style:{fontSize:"18px",color:"rgb(37 99 235)"},attrs:{type:"check-circle",theme:"twoTone"}}),a("a-icon",{directives:[{name:"show",rawName:"v-show",value:e.hover&&t.list.selected.length>0,expression:"item.hover && list.selected.length > 0"}],staticClass:"absolute top-1 left-2 font-bold cursor-pointer transition-all",style:{fontSize:"18px"},attrs:{type:"profile",theme:"twoTone"},on:{click:function(a){return a.stopPropagation(),t.handleOpenDetail(e)}}})],1)])]}}])})],1)],1),a("div",{staticClass:"page-wrapper"},[a("a-pagination",{staticClass:"pagination",attrs:{current:t.pagination.page,defaultPageSize:t.pagination.size,pageSizeOptions:["18","36","54","72","90","108"],total:t.pagination.total,showLessItems:"",showSizeChanger:""},on:{change:t.handlePageChange,showSizeChange:t.handlePageSizeChange}})],1),a("AttachmentUploadModal",{attrs:{visible:t.upload.visible},on:{"update:visible":function(e){return t.$set(t.upload,"visible",e)},close:t.onUploadClose}}),a("AttachmentDetailModal",{attrs:{addToPhoto:!0,attachment:t.list.current,visible:t.detailVisible},on:{"update:visible":function(e){t.detailVisible=e},delete:function(e){return t.handleListAttachments()}},scopedSlots:t._u([{key:"extraFooter",fn:function(){return[a("a-button",{attrs:{disabled:t.selectPreviousButtonDisabled},on:{click:t.handleSelectPrevious}},[t._v("上一项")]),a("a-button",{attrs:{disabled:t.selectNextButtonDisabled},on:{click:t.handleSelectNext}},[t._v("下一项")])]},proxy:!0}])})],1)},i=[],l=a(3832),n=a(50990),o=a(1540),r=a(78588),c={components:{PageView:n.B4},mixins:[l.jB,l.KT],filters:{typeText(t){return r.k[t].text}},data(){return{list:{data:[],loading:!1,total:0,hasNext:!1,hasPrevious:!1,params:{page:0,size:18,keyword:void 0,mediaType:void 0,attachmentType:void 0},selected:[],current:{}},mediaTypes:{data:[],loading:!1},types:{data:[],loading:!1},upload:{visible:!1},detailVisible:!1}},computed:{isImage(){return function(t){return!(!t||!t.mediaType)&&t.mediaType.startsWith("image")}},isItemSelect(){return function(t){return this.list.selected.findIndex((e=>e.id===t.id))>-1}},pagination(){return{page:this.list.params.page+1,size:this.list.params.size,total:this.list.total}},selectPreviousButtonDisabled(){const t=this.list.data.findIndex((t=>t.id===this.list.current.id));return 0===t&&!this.list.hasPrevious},selectNextButtonDisabled(){const t=this.list.data.findIndex((t=>t.id===this.list.current.id));return t===this.list.data.length-1&&!this.list.hasNext}},created(){this.handleListAttachments(),this.handleListMediaTypes(),this.handleListTypes()},methods:{async handleListAttachments(){try{this.list.loading=!0;const t=await o.Z.attachment.list(this.list.params);this.list.data=t.data.content,this.list.total=t.data.total,this.list.hasNext=t.data.hasNext,this.list.hasPrevious=t.data.hasPrevious}catch(t){this.$log.error(t)}finally{this.list.loading=!1}},async handleListMediaTypes(){try{this.mediaTypes.loading=!0;const t=await o.Z.attachment.listMediaTypes();this.mediaTypes.data=t.data}catch(t){this.$log.error(t)}finally{this.mediaTypes.loading=!1}},async handleListTypes(){try{this.types.loading=!0;const t=await o.Z.attachment.listTypes();this.types.data=t.data}catch(t){this.$log.error(t)}finally{this.types.loading=!1}},handleOpenDetail(t){this.list.current=t,this.detailVisible=!0},handleItemClick(t){this.list.selected.length<=0?this.handleOpenDetail(t):this.isItemSelect(t)?this.handleUnselect(t):this.handleSelect(t)},handleSelect(t){this.list.selected=[...this.list.selected,t]},handleUnselect(t){this.list.selected=this.list.selected.filter((e=>e.id!==t.id))},handleSelectAll(){this.list.selected=this.list.data},handleContextMenu(t,e){return this.$contextmenu({items:[{label:`复制${this.isImage(e)?"图片":"文件"}链接`,onClick:()=>{const t=`${encodeURI(e.path)}`;this.$copyText(t).then((t=>{this.$log.debug("copy",t),this.$message.success("复制成功！")})).catch((t=>{this.$log.debug("copy.err",t),this.$message.error("复制失败！")}))},divided:!0},{disabled:!this.isImage(e),label:"复制 Markdown 格式链接",onClick:()=>{const t=`![${e.name}](${encodeURI(e.path)})`;this.$copyText(t).then((t=>{this.$log.debug("copy",t),this.$message.success("复制成功！")})).catch((t=>{this.$log.debug("copy.err",t),this.$message.error("复制失败！")}))},divided:!0},{label:"删除",onClick:()=>{this.$confirm({title:"提示",content:"确定删除该附件？",okText:"确定",cancelText:"取消",onOk:async()=>{await o.Z.attachment["delete"](e.id),await this.handleListAttachments(),this.handleUnselect(e)}})}}],event:t,minWidth:210}),!1},handlePageChange(t=1){this.list.params.page=t-1,this.handleListAttachments()},handlePageSizeChange(t,e){this.$log.debug(`Current: ${t}, PageSize: ${e}`),this.list.params.page=0,this.list.params.size=e,this.handleListAttachments()},handleResetParam(){this.list.params.keyword=void 0,this.list.params.mediaType=void 0,this.list.params.attachmentType=void 0,this.handlePageChange(),this.handleListMediaTypes(),this.handleListTypes()},handleQuery(){this.handlePageChange()},onUploadClose(){this.handlePageChange(),this.handleListMediaTypes(),this.handleListTypes()},handleDeleteAttachmentInBatch(){const t=this;this.list.selected.length<=0?this.$message.warn("你还未选择任何附件，请至少选择一个！"):this.$confirm({title:"确定要批量删除选中的附件吗？",content:"一旦删除不可恢复，请谨慎操作",async onOk(){try{const e=t.list.selected.map((t=>t.id));await o.Z.attachment.deleteInBatch(e),t.list.selected=[],t.$message.success("删除成功")}catch(e){t.$log.error("Failed to delete selected attachments",e)}finally{await t.handleListAttachments()}}})},async handleSelectPrevious(){const t=this.list.data.findIndex((t=>t.id===this.list.current.id));t>0?this.list.current=this.list.data[t-1]:0===t&&this.list.hasPrevious&&(this.list.params.page--,await this.handleListAttachments(),this.list.current=this.list.data[this.list.data.length-1])},async handleSelectNext(){const t=this.list.data.findIndex((t=>t.id===this.list.current.id));t<this.list.data.length-1?this.list.current=this.list.data[t+1]:t===this.list.data.length-1&&this.list.hasNext&&(this.list.params.page++,await this.handleListAttachments(),this.list.current=this.list.data[0])}}},d=c,h=a(18156),u=(0,h.Z)(d,s,i,!1,null,null,null),p=u.exports}}]);